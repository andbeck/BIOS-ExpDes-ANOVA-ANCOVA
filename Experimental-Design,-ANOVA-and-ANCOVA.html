<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>An Introduction to Experimental Design ANOVA and ANCOVA</title>
  <meta name="description" content="This is an introduction to Experimental Design, ANOVA and ANCOVA analyses." />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="An Introduction to Experimental Design ANOVA and ANCOVA" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is an introduction to Experimental Design, ANOVA and ANCOVA analyses." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="An Introduction to Experimental Design ANOVA and ANCOVA" />
  
  <meta name="twitter:description" content="This is an introduction to Experimental Design, ANOVA and ANCOVA analyses." />
  

<meta name="author" content="Andrew P Beckerman (with support from text and slides from Mark Rees and Gareth Phoenix)" />


<meta name="date" content="2022-11-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">An Introduction to Experimental Design ANOVA and ANCOVA</h1>
<p class="author"><em>Andrew P Beckerman (with support from text and slides from Mark Rees and Gareth Phoenix)</em></p>
<p class="date"><em>2022-11-25</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#introduction" id="toc-introduction"><span class="toc-section-number">1</span> Introduction</a>
<ul>
<li><a href="#the-three-rs-the-foundation-of-experimental-design." id="toc-the-three-rs-the-foundation-of-experimental-design."><span class="toc-section-number">1.1</span> The Three Rs: The Foundation of Experimental Design.</a></li>
<li><a href="#the-general-linear-model" id="toc-the-general-linear-model"><span class="toc-section-number">1.2</span> The General Linear Model</a></li>
</ul></li>
<li><a href="#readings--" id="toc-readings--"><span class="toc-section-number">2</span> Readings —-</a>
<ul>
<li><a href="#install-some-extra-packages--" id="toc-install-some-extra-packages--"><span class="toc-section-number">2.1</span> Install some extra packages —-</a></li>
</ul></li>
<li><a href="#intro" id="toc-intro"><span class="toc-section-number">3</span> Introduction To Experimental Design</a>
<ul>
<li><a href="#conepts-associated-with-causation" id="toc-conepts-associated-with-causation"><span class="toc-section-number">3.1</span> Conepts associated with causation</a></li>
<li><a href="#components-of-an-experiment" id="toc-components-of-an-experiment"><span class="toc-section-number">3.2</span> Components of an Experiment</a></li>
<li><a href="#how-do-we-increase-precision-and-reduce-bias" id="toc-how-do-we-increase-precision-and-reduce-bias"><span class="toc-section-number">3.3</span> How do we increase precision and reduce bias?</a>
<ul>
<li><a href="#blinding" id="toc-blinding"><span class="toc-section-number">3.3.1</span> Blinding</a></li>
<li><a href="#placebos" id="toc-placebos"><span class="toc-section-number">3.3.2</span> Placebos</a></li>
<li><a href="#confounders" id="toc-confounders"><span class="toc-section-number">3.3.3</span> Confounders</a></li>
</ul></li>
<li><a href="#experimental-vs.-measurement-units" id="toc-experimental-vs.-measurement-units"><span class="toc-section-number">3.4</span> Experimental vs. Measurement units</a>
<ul>
<li><a href="#the-challenge-question" id="toc-the-challenge-question"><span class="toc-section-number">3.4.1</span> The challenge question</a></li>
<li><a href="#identifying-the-experimental-unit---an-example-of-pseudo-replication" id="toc-identifying-the-experimental-unit---an-example-of-pseudo-replication"><span class="toc-section-number">3.4.2</span> Identifying the experimental unit - an example of <strong>pseudo-replication</strong></a></li>
<li><a href="#psudo-replication" id="toc-psudo-replication"><span class="toc-section-number">3.4.3</span> Psudo-replication</a></li>
<li><a href="#randomization-properly-with-replication-protects-against-confounding" id="toc-randomization-properly-with-replication-protects-against-confounding"><span class="toc-section-number">3.4.4</span> Randomization properly with Replication protects against Confounding</a></li>
<li><a href="#haphazard-is-not-randomized---beware-the-non-randomized-experiment" id="toc-haphazard-is-not-randomized---beware-the-non-randomized-experiment"><span class="toc-section-number">3.4.5</span> <strong>haphazard</strong> is NOT randomized - beware the non-randomized experiment –</a></li>
</ul></li>
<li><a href="#mini-quiz" id="toc-mini-quiz"><span class="toc-section-number">3.5</span> Mini-Quiz</a></li>
<li><a href="#replication-how-many" id="toc-replication-how-many"><span class="toc-section-number">3.6</span> Replication: How many?</a></li>
</ul></li>
<li><a href="#examples-and-challenge-questions" id="toc-examples-and-challenge-questions"><span class="toc-section-number">4</span> Examples and Challenge Questions</a>
<ul>
<li><a href="#designing-your-first-experiment" id="toc-designing-your-first-experiment"><span class="toc-section-number">4.1</span> Designing your first experiment</a></li>
<li><a href="#using-r-to-generate-experimental-designs" id="toc-using-r-to-generate-experimental-designs"><span class="toc-section-number">4.2</span> Using R to generate Experimental Designs</a></li>
</ul></li>
<li><a href="#design-and-analysis-of-experiments" id="toc-design-and-analysis-of-experiments"><span class="toc-section-number">5</span> Design and Analysis of Experiments</a>
<ul>
<li><a href="#example-one" id="toc-example-one"><span class="toc-section-number">5.1</span> Example one</a>
<ul>
<li><a href="#making-up-data" id="toc-making-up-data"><span class="toc-section-number">5.1.1</span> Making up data</a></li>
<li><a href="#into-the-dplyr-and-ggplot-pipeline." id="toc-into-the-dplyr-and-ggplot-pipeline."><span class="toc-section-number">5.1.2</span> Into the dplyr and ggplot pipeline.</a></li>
</ul></li>
<li><a href="#the-one-way-anova." id="toc-the-one-way-anova."><span class="toc-section-number">5.2</span> The One-Way ANOVA.</a>
<ul>
<li><a href="#making-insight-and-inference" id="toc-making-insight-and-inference"><span class="toc-section-number">5.2.1</span> Making insight and inference</a></li>
</ul></li>
<li><a href="#a-priori-vs.-post-hoc-contrasts" id="toc-a-priori-vs.-post-hoc-contrasts"><span class="toc-section-number">5.3</span> A priori vs. Post-Hoc Contrasts</a>
<ul>
<li><a href="#the-more-appropriate-approach." id="toc-the-more-appropriate-approach."><span class="toc-section-number">5.3.1</span> The more appropriate approach.</a></li>
<li><a href="#comparing-the-average-of-the-herbicide-effect-with-the-control." id="toc-comparing-the-average-of-the-herbicide-effect-with-the-control."><span class="toc-section-number">5.3.2</span> comparing the average of the herbicide effect with the control.</a></li>
<li><a href="#writing-this-up" id="toc-writing-this-up"><span class="toc-section-number">5.3.3</span> writing this up…</a></li>
</ul></li>
</ul></li>
<li><a href="#randomized-complete-block-design-rcb" id="toc-randomized-complete-block-design-rcb"><span class="toc-section-number">6</span> Randomized Complete Block design (RCB)</a>
<ul>
<li><a href="#an-example-of-the-rcbd" id="toc-an-example-of-the-rcbd"><span class="toc-section-number">6.1</span> An example of the RCBD</a></li>
<li><a href="#analysing-the-crbd" id="toc-analysing-the-crbd"><span class="toc-section-number">6.2</span> Analysing the CRBD</a>
<ul>
<li><a href="#building-the-model" id="toc-building-the-model"><span class="toc-section-number">6.2.1</span> Building the model</a></li>
<li><a href="#are-the-estimates-of-the-parameters-what-we-expect" id="toc-are-the-estimates-of-the-parameters-what-we-expect"><span class="toc-section-number">6.2.2</span> Are the estimates of the parameters what we expect?</a></li>
<li><a href="#correct-standard-errors-for-a-figure" id="toc-correct-standard-errors-for-a-figure"><span class="toc-section-number">6.2.3</span> Correct Standard Errors for a Figure</a></li>
<li><a href="#making-inference-confidence-intervals-and-contrasts" id="toc-making-inference-confidence-intervals-and-contrasts"><span class="toc-section-number">6.2.4</span> Making inference: confidence intervals and contrasts</a></li>
</ul></li>
</ul></li>
<li><a href="#designs-for-testing-for-interactions-factorial-designs." id="toc-designs-for-testing-for-interactions-factorial-designs."><span class="toc-section-number">7</span> Designs for testing for interactions: factorial designs.</a>
<ul>
<li><a href="#introducing-interactions" id="toc-introducing-interactions"><span class="toc-section-number">7.1</span> Introducing Interactions</a>
<ul>
<li><a href="#lets-design-an-experiment-again" id="toc-lets-design-an-experiment-again"><span class="toc-section-number">7.1.1</span> Let’s design an experiment, again…</a></li>
<li><a href="#the-factorial-design-how-and-why-study-interactions" id="toc-the-factorial-design-how-and-why-study-interactions"><span class="toc-section-number">7.1.2</span> The Factorial Design: How and Why Study Interactions?</a></li>
</ul></li>
<li><a href="#a-factorial-design-and-the-two-way-anova" id="toc-a-factorial-design-and-the-two-way-anova"><span class="toc-section-number">7.2</span> A Factorial Design and the Two-Way ANOVA</a>
<ul>
<li><a href="#build-the-data" id="toc-build-the-data"><span class="toc-section-number">7.2.1</span> Build the Data</a></li>
<li><a href="#plot-the-data" id="toc-plot-the-data"><span class="toc-section-number">7.2.2</span> Plot the data!</a></li>
<li><a href="#analyse-the-data" id="toc-analyse-the-data"><span class="toc-section-number">7.2.3</span> Analyse the data</a></li>
<li><a href="#final-figuring" id="toc-final-figuring"><span class="toc-section-number">7.2.4</span> final figuring</a></li>
</ul></li>
</ul></li>
<li><a href="#a-summary-experimental-design-and-anova" id="toc-a-summary-experimental-design-and-anova"><span class="toc-section-number">8</span> A Summary: Experimental Design and ANOVA</a>
<ul>
<li><a href="#how-to-analyse-anova-models" id="toc-how-to-analyse-anova-models"><span class="toc-section-number">8.1</span> How To Analyse ANOVA models</a></li>
<li><a href="#experimental-designs." id="toc-experimental-designs."><span class="toc-section-number">8.2</span> Experimental Designs.</a></li>
<li><a href="#clever-r-stuff" id="toc-clever-r-stuff"><span class="toc-section-number">8.3</span> Clever R Stuff</a></li>
</ul></li>
<li><a href="#introducing-the-ancova---the-analysis-of-covariance" id="toc-introducing-the-ancova---the-analysis-of-covariance"><span class="toc-section-number">9</span> Introducing the ANCOVA - the analysis of covariance</a>
<ul>
<li><a href="#setting-up-the-various-ideas." id="toc-setting-up-the-various-ideas."><span class="toc-section-number">9.1</span> Setting up the various ideas.</a></li>
<li><a href="#working-through-and-example." id="toc-working-through-and-example."><span class="toc-section-number">9.2</span> Working through and example.</a>
<ul>
<li><a href="#get-the-data-and-make-your-picture" id="toc-get-the-data-and-make-your-picture"><span class="toc-section-number">9.2.1</span> Get the data and make your picture</a></li>
</ul></li>
<li><a href="#building-the-model-and-understanding-it" id="toc-building-the-model-and-understanding-it"><span class="toc-section-number">9.3</span> Building the model (and understanding it)</a>
<ul>
<li><a href="#dealing-with-some-issues-with-residuals." id="toc-dealing-with-some-issues-with-residuals."><span class="toc-section-number">9.3.1</span> Dealing with some issues with residuals.</a></li>
<li><a href="#making-inference-on-the-ancova" id="toc-making-inference-on-the-ancova"><span class="toc-section-number">9.3.2</span> Making inference on the ANCOVA</a></li>
<li><a href="#the-summary-table-and-making-sense-of-the-log-stuff." id="toc-the-summary-table-and-making-sense-of-the-log-stuff."><span class="toc-section-number">9.3.3</span> The summary table and making sense of the log stuff.</a></li>
<li><a href="#the-equations-supported-by-the-model." id="toc-the-equations-supported-by-the-model."><span class="toc-section-number">9.3.4</span> The equations supported by the model.</a></li>
<li><a href="#making-even-more-inference-and-drawing-the-picture" id="toc-making-even-more-inference-and-drawing-the-picture"><span class="toc-section-number">9.3.5</span> Making even more inference and drawing the picture</a></li>
</ul></li>
<li><a href="#some-general-principles" id="toc-some-general-principles"><span class="toc-section-number">9.4</span> Some General Principles</a>
<ul>
<li><a href="#ancova-always-tests-the-interaction-against-the-additive-model" id="toc-ancova-always-tests-the-interaction-against-the-additive-model"><span class="toc-section-number">9.4.1</span> ANCOVA always tests the interaction against the additive model</a></li>
<li><a href="#specifying-models-in-r" id="toc-specifying-models-in-r"><span class="toc-section-number">9.4.2</span> Specifying models in R</a></li>
</ul></li>
</ul></li>
<li><a href="#introduction-1" id="toc-introduction-1"><span class="toc-section-number">10</span> Introduction</a>
<ul>
<li><a href="#the-three-rs-the-foundation-of-experimental-design.-1" id="toc-the-three-rs-the-foundation-of-experimental-design.-1"><span class="toc-section-number">10.1</span> The Three Rs: The Foundation of Experimental Design.</a></li>
<li><a href="#the-general-linear-model-1" id="toc-the-general-linear-model-1"><span class="toc-section-number">10.2</span> The General Linear Model</a></li>
</ul></li>
<li><a href="#readings---1" id="toc-readings---1"><span class="toc-section-number">11</span> Readings —-</a>
<ul>
<li><a href="#install-some-extra-packages---1" id="toc-install-some-extra-packages---1"><span class="toc-section-number">11.1</span> Install some extra packages —-</a></li>
</ul></li>
<li><a href="#intro" id="toc-intro"><span class="toc-section-number">12</span> Introduction To Experimental Design</a>
<ul>
<li><a href="#conepts-associated-with-causation-1" id="toc-conepts-associated-with-causation-1"><span class="toc-section-number">12.1</span> Conepts associated with causation</a></li>
<li><a href="#components-of-an-experiment-1" id="toc-components-of-an-experiment-1"><span class="toc-section-number">12.2</span> Components of an Experiment</a></li>
<li><a href="#how-do-we-increase-precision-and-reduce-bias-1" id="toc-how-do-we-increase-precision-and-reduce-bias-1"><span class="toc-section-number">12.3</span> How do we increase precision and reduce bias?</a>
<ul>
<li><a href="#blinding-1" id="toc-blinding-1"><span class="toc-section-number">12.3.1</span> Blinding</a></li>
<li><a href="#placebos-1" id="toc-placebos-1"><span class="toc-section-number">12.3.2</span> Placebos</a></li>
<li><a href="#confounders-1" id="toc-confounders-1"><span class="toc-section-number">12.3.3</span> Confounders</a></li>
</ul></li>
<li><a href="#experimental-vs.-measurement-units-1" id="toc-experimental-vs.-measurement-units-1"><span class="toc-section-number">12.4</span> Experimental vs. Measurement units</a>
<ul>
<li><a href="#the-challenge-question-1" id="toc-the-challenge-question-1"><span class="toc-section-number">12.4.1</span> The challenge question</a></li>
<li><a href="#identifying-the-experimental-unit---an-example-of-pseudo-replication-1" id="toc-identifying-the-experimental-unit---an-example-of-pseudo-replication-1"><span class="toc-section-number">12.4.2</span> Identifying the experimental unit - an example of <strong>pseudo-replication</strong></a></li>
<li><a href="#psudo-replication-1" id="toc-psudo-replication-1"><span class="toc-section-number">12.4.3</span> Psudo-replication</a></li>
<li><a href="#randomization-properly-with-replication-protects-against-confounding-1" id="toc-randomization-properly-with-replication-protects-against-confounding-1"><span class="toc-section-number">12.4.4</span> Randomization properly with Replication protects against Confounding</a></li>
<li><a href="#haphazard-is-not-randomized---beware-the-non-randomized-experiment-1" id="toc-haphazard-is-not-randomized---beware-the-non-randomized-experiment-1"><span class="toc-section-number">12.4.5</span> <strong>haphazard</strong> is NOT randomized - beware the non-randomized experiment –</a></li>
</ul></li>
<li><a href="#mini-quiz-1" id="toc-mini-quiz-1"><span class="toc-section-number">12.5</span> Mini-Quiz</a></li>
<li><a href="#replication-how-many-1" id="toc-replication-how-many-1"><span class="toc-section-number">12.6</span> Replication: How many?</a></li>
</ul></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">An Introduction to Experimental Design ANOVA and ANCOVA</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="introduction" class="section level1 hasAnchor" number="1">
<h1 class="hasAnchor"><span class="header-section-number">1</span> Introduction<a href="#introduction" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Welcome to An Introduction to Experimental Design ANOVA and ANCOVA</p>
<p>In this mini-module, you’ll be learning about the principles of experimental design and analysis of a few classic designes, the 2x2 ANOVA and ANCOVA experiments.</p>
<p>This module is compulsory for all, because it forms the foundation for most of the more complex experiments you will do as a researcher. And it is the major step beyond the t-test, 1-way ANOVA, simple regression and chi-square contingency table analyses we’ve covered thus far.</p>
<p>The learning outcome for this mini-module are that you will understand the basic ideas about</p>
<ul>
<li>Replication, Randomisation and Reducing Noise</li>
<li>Precision, Bias and Systematic Error</li>
<li>The Completely Randomised Design</li>
<li>The Randomised Block Design</li>
<li>The 2-way ANOVA</li>
<li>The ANCOVA Design</li>
</ul>
<p>In order to be successful with this final section of the course, you need to feel comfortable with the 1-way ANOVA and the Regression model. Please review these concepts. You can also refer to Chapter 5 and 6 in Getting Started with R (available as an online Resource via STARPlus) which covers a great deal of the mechanics of using R to do these types of models. Finally, you will also need to feel comfortable with dplyr and ggplot - we’ll be reinforcing the old stuff and introducing a few new tricks.</p>
<div id="the-three-rs-the-foundation-of-experimental-design." class="section level2 hasAnchor" number="1.1">
<h2 class="hasAnchor"><span class="header-section-number">1.1</span> The Three Rs: The Foundation of Experimental Design.<a href="#the-three-rs-the-foundation-of-experimental-design." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Before we get started, it’s vital that you understand that there are some very basic principles needed to ensure that your experiments can provide robust and reliable inference (answers to your questions). The “3 R’s”.</p>
<ul>
<li><strong>Randomisation</strong>: the random allocation of treatments to the experimental units, to avoid confounding between treatment effects and other unknown effects.</li>
<li><strong>Replication</strong>: the repetition of a treatment within an experiment, to quantify the natural variation between experimental units and increase accuracy of estimated effects.</li>
<li><strong>Reduce noise:</strong> by controlling as much as possible the conditions in the experiment, e.g. by grouping of similar experimental units in blocks.</li>
</ul>
<p>As we develop our understanding of experimental design, you should come back to these core definitions and see if your understanding of them has improved. We work on these concepts in the next chapter of the book.</p>
</div>
<div id="the-general-linear-model" class="section level2 hasAnchor" number="1.2">
<h2 class="hasAnchor"><span class="header-section-number">1.2</span> The General Linear Model<a href="#the-general-linear-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section of the course is focused on a class of model called the General Linear Model. It is not a <strong>GLM</strong>. The <strong>GLM</strong> is a generalised linear model. I know, right?</p>
<p>The general linear model is, as we learned in the past few weeks, a model fit in R with the <code>lm()</code> function. It includes regression, ANOVA, ANCOVA and variations of these.</p>
<p>There are a few key characterstics to remember about these models. The general linear model has the following form:</p>
<p><span class="math inline">\(y = \beta_{0}+\beta_{1}*X_{1}+\beta_{2}*X_{2}+\epsilon\)</span></p>
<p>Where the <span class="math inline">\(y\)</span> is the response variable, the <span class="math inline">\(\beta\)</span>’s are estimated parameters, the <span class="math inline">\(X\)</span>’s are the predictor variables and the <span class="math inline">\(\epsilon\)</span> comes from a Gaussian distribution with zero mean and constant variance.</p>
<p>Let’s decompose that a bit more.</p>
<p>There are two types of predictor variable:</p>
<p><em>Metric</em> predictor variables are measurements of some quantity that may help to predict the value of the response. For example, if the response is the blood pressure of patients in a clinical trial, then age, fat mass and height are potential metric predictor variables. You may know these as <strong>continuous explanatory (independent) variables</strong></p>
<p><em>Factor</em> variables are labels that serve to categorize the response measurements into groups, which may have different expected values. Continuing the blood pressure example, factor variables might be sex and drug treatment received (drug A, drug B or placebo, for example). You may also know these as <strong>categorical explanatory (independent) variables</strong>.</p>
<p>So, you hopefully can see how this <em>general</em> linear model is capable of representing</p>
<ol style="list-style-type: decimal">
<li><em>ANOVA</em> – Analysis of variance -&gt; Predictors are factors.</li>
<li><em>Regression</em> -&gt; Predictor is a metric variable (continuous variable).<br />
</li>
<li><em>Multiple regression</em> -&gt; Predictors are metric variables (continuous variables).</li>
<li><em>ANCOVA</em> - Analysis of co-variance -&gt; Predictors are a mixture of metric variables (continuous variables) and factors.</li>
</ol>
<p>Finally, it is important to understand that non-linear relationships such as these data below can be modelled with a linear model:</p>
<p><img src="Experimental-Design,-ANOVA-and-ANCOVA_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>How, you ask!? Well…. consider this equation:</p>
<p><span class="math inline">\(y = 0.01 + x + x^{2} + \epsilon\)</span></p>
<p>Referring to our generic model structure above,</p>
<p><span class="math inline">\(y = \beta_{0}+\beta_{1}*X_{1}+\beta_{2}*X_{2}+\epsilon\)</span></p>
<p>we hopefully can see that <span class="math inline">\(\beta_{0} = 0.01\)</span>, <span class="math inline">\(\beta_{1} = 0\)</span> and <span class="math inline">\(\beta_{2} = 1\)</span>, where <span class="math inline">\(X_{2} = X^{2}\)</span>!</p>
<p>Linear models are perfectly capable of being used to estimate non-linear relationships!</p>
<p>Here is the code to make that figure.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set x range</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">100</span><span class="sc">:</span><span class="dv">100</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># define y without error</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>y_det <span class="ot">&lt;-</span> <span class="fl">0.01</span><span class="sc">+</span>x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># add some random variation</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> y_det<span class="sc">+</span><span class="fu">rnorm</span>(<span class="fu">length</span>(x),<span class="dv">0</span>,<span class="dv">1000</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataframe and plot</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, y)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y))<span class="sc">+</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
</div>
</div>
<div id="readings--" class="section level1 hasAnchor" number="2">
<h1 class="hasAnchor"><span class="header-section-number">2</span> Readings —-<a href="#readings--" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>There are several resources that will help with this section of the stats course, and onwards</p>
<ul>
<li>Getting Started with R - An Introducton for Biologists, Second Edition (available as an electronic online resource via StarPlus). Specifically Chapter 5 and 6.</li>
<li>Experimental Design for the Life Sciences - Nick Colegrave and Graham Ruxton (seen on eBay for £2.50!)</li>
<li>Of course, the venerable coursebook for APS 240: <a href="https://dzchilds.github.io/stats-for-bio/index.html" class="uri">https://dzchilds.github.io/stats-for-bio/index.html</a></li>
</ul>
<div id="install-some-extra-packages--" class="section level2 hasAnchor" number="2.1">
<h2 class="hasAnchor"><span class="header-section-number">2.1</span> Install some extra packages —-<a href="#install-some-extra-packages--" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In order to make this module more effective, we are going to use some additional resources from CRAN.</p>
<p>Please install these packages, if you have not already, using the install packages tab in RStudio:</p>
<ul>
<li><code>tidyverse</code></li>
<li><code>ggfortify</code></li>
<li><code>agricolae</code></li>
<li><code>car</code></li>
<li><code>gmodels</code></li>
<li><code>visreg</code></li>
<li><code>patchwork</code></li>
</ul>
<!--chapter:end:index.Rmd-->
</div>
</div>
<div id="intro" class="section level1 hasAnchor" number="3">
<h1 class="hasAnchor"><span class="header-section-number">3</span> Introduction To Experimental Design<a href="#intro" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Experiments help us answer questions, but there are also non-experimental techniques. What is so special about experiments?</p>
<p>One of the central features of an experiment is the <em>treatment</em> - a manipulation of some variable of interest that should have an effect on the response variable we are investigating. Whether you are manipulating the levels of a hormone to explore it’s impact on a cell/organ or embryo development, the concentration of a drug to explore it’s efficancy in treating a disease or the levels of nitrogen in soil to explore the impacts on plant growth, a treatment is a deliberate manipulation.</p>
<p>It is also important to remember that there can be <em>natural</em> treatments - there may be natural variation among cells, organisms or gradients in the environment that you can use to represent treatments.</p>
<p>So, to be very clear:</p>
<ol style="list-style-type: decimal">
<li>Experiments allow us to set up a direct comparison among the <em>levels</em> or <em>values</em> of <em>treatments</em> of interest.</li>
<li>We can design experiments to minimize any bias in the comparison.</li>
<li>We can design experiments so that the error in the comparison is small.</li>
<li>We design experiments to be in control, and having that control allows us to make stronger inferences about the nature of differences that we see in the response variable.</li>
</ol>
<blockquote>
<p>Experiments allow us to move towards making inferences about causation.</p>
</blockquote>
<p>This last point distinguishes an experiment from an observational study. In an observational study we merely observe which units are in which treatment groups; we don’t get to <em>control that assignment</em>. This underpins the classic issue with assigning <em>causation to correlation</em> - in the following two examples, there is a strong association between the variables, but there has been no control/manipulation.</p>
<p><img src="images/IceCream_Shark.png" width="268" /><img src="images/Autism_Organic.png" width="320" /></p>
<div id="conepts-associated-with-causation" class="section level2 hasAnchor" number="3.1">
<h2 class="hasAnchor"><span class="header-section-number">3.1</span> Conepts associated with causation<a href="#conepts-associated-with-causation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Mosteller and Tukey (1977) list three concepts associated with causation and state that at least two (preferably all three) are needed to support a causal relationship:</p>
<ul>
<li><em>Consistency</em> – make a change and the response is in the same direction or the amount of response is <em>consistent</em> across populations</li>
<li><em>Responsiveness</em> – make a change and the response changes according to theory</li>
<li><em>Mechanism</em> – make a change and we can monitor/identify a mechanism leading from cause to effect</li>
</ul>
<p>Let’s look at a classic example. Smoking and lung cancer – from 1922 to 1947 annual deaths for lung cancer went from 612 to 9287 (Observation). This was thought in the 1950s to be either an effect of smoking tobacco or atmospheric pollution (Hypothesis). Numerous studies showed that lung cancer was more prevalent in smokers (Observation: <em>consistency</em>). Chemical analyses of tobacco showed it contained carcinogens (Association: <em>mechanism</em>). Public health programs resulted in a reduction in smoking and lung cancer rates decreased (Intervention: <em>responsiveness</em>).</p>
<p>Note the initial study was an observational study and in this case it was not ethical to do the experiment per se!</p>
</div>
<div id="components-of-an-experiment" class="section level2 hasAnchor" number="3.2">
<h2 class="hasAnchor"><span class="header-section-number">3.2</span> Components of an Experiment<a href="#components-of-an-experiment" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>An experiment has <em>treatments, experimental units, responses, and a method to assign treatments to units</em>. These four things specify the experimental design.</p>
<p>Not all experimental designs are created equal. A good experimental design must adhere to the 3Rs. It should reveal consistency, responsiveness and mechanism. The way this happens is by avoiding systematic error in measuring things, and allow estimation of error in measurements with precision.</p>
<p>In short, a good experimental design must:</p>
<ul>
<li>Avoid systematic error</li>
<li>Allow estimation of error</li>
<li>Be precise</li>
<li>Have broad validity.</li>
</ul>
<p>Lets walk through some definitions.</p>
<p>If our experiment has <em>systematic error</em>, then our comparisons will be biased, no matter how precise our measurements are or how many experimental units we use. <strong>Randomisation</strong> is our tool to combat <em>systematic error</em>.</p>
<p>Even without <em>systematic error</em>, there will be random error in the responses - this is what we call variation in what we are measuring or more formally variance. Such variation in responses invariably leads to random error in the treatment comparisons. When we compared two means in the t-test, we had to deal with the variation in both groups!</p>
<p>Experiments are precise when this random error in the treatment comparisons is small. Precision depends on the size of the random errors in the responses, the number of units used (<strong>replication</strong>), and the experimental design used.</p>
<p>Experiments must be designed so that we have an estimate of the size of random error. This permits statistical inference: for example, confidence intervals (which arise from standard errors) or tests of significance based on t- or F-statistics.</p>
<p>We cannot do inference without an estimate of this variation. We would like our conclusions to be valid for a wide population, so we need to <em>randomise</em> our subjects or objects we are measuring - for example, we may need to be aware of both sexes and of young and old individuals. But there are always compromises - for example, broadening the scope of validity by using a variety of experimental units may decrease the precision of the responses.</p>
</div>
<div id="how-do-we-increase-precision-and-reduce-bias" class="section level2 hasAnchor" number="3.3">
<h2 class="hasAnchor"><span class="header-section-number">3.3</span> How do we increase precision and reduce bias?<a href="#how-do-we-increase-precision-and-reduce-bias" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are several key concepts</p>
<div id="blinding" class="section level3 hasAnchor" number="3.3.1">
<h3 class="hasAnchor"><span class="header-section-number">3.3.1</span> Blinding<a href="#blinding" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>Blinding</em> occurs when the evaluators of a response do not know which treatment was given to which unit. Blinding helps prevent bias in the evaluation, even unconscious bias from well-intentioned evaluators. Double blinding occurs when both the evaluators of the response and the (human subject) experimental units do not know the assignment of treatments to units. Blinding the subjects can also prevent bias, because subject responses can change when subjects have expectations for certain treatments.</p>
</div>
<div id="placebos" class="section level3 hasAnchor" number="3.3.2">
<h3 class="hasAnchor"><span class="header-section-number">3.3.2</span> Placebos<a href="#placebos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>Placebo</em> is a null treatment that is used when the <em>act</em> of applying a treatment— any treatment — has an effect. Placebos are often used with human subjects, because people often respond to the process of receiving any treatment: for example,
reduction in headache pain when given a sugar pill. Blinding is important when placebos are used with human subjects. Placebos are also useful for nonhuman subjects. The apparatus for spraying a field with a pesticide may compact the soil. Thus we drive the apparatus over the field, without actually spraying, as a placebo treatment.</p>
</div>
<div id="confounders" class="section level3 hasAnchor" number="3.3.3">
<h3 class="hasAnchor"><span class="header-section-number">3.3.3</span> Confounders<a href="#confounders" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>Confounding</em> occurs when the effect of one factor or treatment cannot be distinguished from that of another factor or treatment. The two factors or treatments are said to be confounded. Except in very special circumstances, confounding should be avoided. Consider the following example. We plant corn variety A in Yorkshire and corn variety B in Lancashire. In this experiment, we cannot distinguish location effects (Yorkshire vs. Lancashire) from variety effects (cornA vs. cornB) — the variety factor and the location factor are confounded.</p>
<p>This is despite the fact that we know that Yorkshire will be better…. (that’s a joke)</p>
</div>
</div>
<div id="experimental-vs.-measurement-units" class="section level2 hasAnchor" number="3.4">
<h2 class="hasAnchor"><span class="header-section-number">3.4</span> Experimental vs. Measurement units<a href="#experimental-vs.-measurement-units" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A common source of difficulty in designing experiments is the distinction between experimental units and measurement units. We need to know the experimental units, as this is the key value used to generate our inference.</p>
<p>Consider an educational study, with six classrooms of 25 pupils. Each classroom of students is then assigned, at random, to one of two different reading programmes.</p>
<p>At the end of a six-week term, all the students are evaluated via a common reading exam.</p>
<div id="the-challenge-question" class="section level3 hasAnchor" number="3.4.1">
<h3 class="hasAnchor"><span class="header-section-number">3.4.1</span> The challenge question<a href="#the-challenge-question" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Are there six experimental units (the classrooms) or 150 (25*6; the students)? We measured the reading ability of the students… but they were in classroom sets of 25….</p>
</blockquote>
</div>
<div id="identifying-the-experimental-unit---an-example-of-pseudo-replication" class="section level3 hasAnchor" number="3.4.2">
<h3 class="hasAnchor"><span class="header-section-number">3.4.2</span> Identifying the experimental unit - an example of <strong>pseudo-replication</strong><a href="#identifying-the-experimental-unit---an-example-of-pseudo-replication" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To identify the experimental units the key question is: To which <em>thing</em> (students or classrooms) did we randomly allocate our treatments?</p>
<p>If we randomly allocated reading programmes to students, then students would be the experimental units. But we didn’t, so the classroom is the experimental unit – it is the classroom to which we randomly allocated treatments.</p>
<p><em>The classroom is the experimental unit</em>.</p>
<p>However, you are right - we don’t <em>measure</em> how a classroom reads; we measure how students read. Thus <em>students are the measurement units</em> for this experiment.</p>
</div>
<div id="psudo-replication" class="section level3 hasAnchor" number="3.4.3">
<h3 class="hasAnchor"><span class="header-section-number">3.4.3</span> Psudo-replication<a href="#psudo-replication" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Confusing these two things can lead to <strong>pseudo-replication</strong>. Treating measurement units as experimental usually leads to overoptimistic analysis — we will reject null hypotheses more often than we should, and our confidence intervals will be too narrow. The usual way around this is to determine a single response for each experimental unit.</p>
<p>Consider an experiment with two growth chambers each containing 100 plants. One of the chambers received enhanced C02. One night after collecting data you leave the door open on the C02 chamber and the temperature drops and so the plants grow more slowly. When you come to analyze the data you get a highly significant effect of slow growth. However, that C02 results in reduced plant growth not what you expect (CO2 is good for photosynthesis…).</p>
<p>This is an entirely plausible outcome caused by misallocating plants as the experimental unit - it was really the CO2 chamber… to avoid such problems, one needs many chambers.</p>
<p>Consider a second experiment where you have 200 growth chambers and randomly allocate plants to each. If you <em>forget to close one door</em> it really has no effect as just one plant is affected. In fact, to get the same effect as in the first experiment you would have to accidentally leave the doors open on all 100 of the elevated C02 chambers. This is very unlikely indeed!!!</p>
<blockquote>
<p>There are 9 x 1058 ways selecting 100 chambers from 200 chambers so the chance of accidentally picking all the elevated C02 chambers is 1/ 9x1058￼0 (stars in universe 7 x 1022).</p>
</blockquote>
<p>Proper <strong>randomization</strong> and <strong>replication</strong> is very different from <strong>pseudo-replication</strong>.</p>
</div>
<div id="randomization-properly-with-replication-protects-against-confounding" class="section level3 hasAnchor" number="3.4.4">
<h3 class="hasAnchor"><span class="header-section-number">3.4.4</span> Randomization properly with Replication protects against Confounding<a href="#randomization-properly-with-replication-protects-against-confounding" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An experiment is properly randomized if the method for assigning treatments to units involves a known, well-understood probabilistic scheme. The probabilistic scheme is called a randomization.</p>
<blockquote>
<p>In general, more experimental units with fewer measurement units per experimental unit works better.</p>
</blockquote>
<p>No matter which features of the population of experimental units are associated with our response, our randomizations should put approximately <em>half the individuals with these features</em> into <em>each treatment group</em>.</p>
<p>Recall our example above of considering sex and age of subjects and imagine a treatment with two levels (hot and cold). Done well, proper randomisation will put approximately half the males, half the females, half the older, half the younger etc into each of the treatment levels.</p>
<p>The beauty of randomization is that it helps prevent <em>confounding</em>, even for factors that we do not know are important.</p>
</div>
<div id="haphazard-is-not-randomized---beware-the-non-randomized-experiment" class="section level3 hasAnchor" number="3.4.5">
<h3 class="hasAnchor"><span class="header-section-number">3.4.5</span> <strong>haphazard</strong> is NOT randomized - beware the non-randomized experiment –<a href="#haphazard-is-not-randomized---beware-the-non-randomized-experiment" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A company is evaluating two different word processing packages for use by its clerical staff. Part of the evaluation is how quickly a test document can be entered correctly using the two programs. We have 20 test secretaries, and each secretary will enter the document twice, using each programme once.</p>
<p>Suppose that all secretaries did the evaluation in the order A first and B second. Does the second programme have an advantage because the secretary will be familiar with the document and thus enter it faster? Or maybe the second programme will be at a disadvantage because the secretary will be tired and thus slower?</p>
<p>Randomization generally costs little in time and trouble, but it can save us from <code>disaster</code>. The experiment above needs secretaries randomly assigned to A first -&gt; B second and B first -&gt; A second (50% in each!).</p>
<p>Anything that might affect your responses should be <em>randomized</em>! For example</p>
<ul>
<li>If the experimental units are not used simultaneously, you can (should) randomize the order in which they are used.</li>
<li>If the experimental units are not used at the same location, you can (should) randomize the locations at which they are used.</li>
<li>If you use more than one measuring instrument for determining response, you can (should) randomize which units are measured on which instruments.</li>
</ul>
</div>
</div>
<div id="mini-quiz" class="section level2 hasAnchor" number="3.5">
<h2 class="hasAnchor"><span class="header-section-number">3.5</span> Mini-Quiz<a href="#mini-quiz" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>A PhD student want to determine the effects of protein on beetle reproduction, so they design an experiment with a control and protein enhanced diet. To assign beetles to each of the treatments they pour a culture onto the table and catch the first 30 beetles that run to the edge of the table, these receive the protein enhanced diet. The next 30 beetles go in the control. <strong>Is this randomized?</strong></p>
</blockquote>
<p>(Hmm …. is there anything about the first 30 beetles that reach the edge of the table that could <em>bias</em> your inference?)</p>
</div>
<div id="replication-how-many" class="section level2 hasAnchor" number="3.6">
<h2 class="hasAnchor"><span class="header-section-number">3.6</span> Replication: How many?<a href="#replication-how-many" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There is a really common question that people ask. How many replicates do I need? Unfortunatly, there are no simple rules… it depends… on….</p>
<ul>
<li>Resources available ($/£/€ and equipment and time)</li>
<li>Variability of experimental units</li>
<li>Treatment structure</li>
<li>Size of effect (response)</li>
<li>Relative importance of different comparisons</li>
</ul>
<p>There is, however, a set of tools that can help with estimating sample sizes. It’s called power analysis and requires that you have some a priori estimate of the expected variation in your response variable.</p>
<!--chapter:end:02-Experiments_and_Some_Philosophy.Rmd-->
</div>
</div>
<div id="examples-and-challenge-questions" class="section level1 hasAnchor" number="4">
<h1 class="hasAnchor"><span class="header-section-number">4</span> Examples and Challenge Questions<a href="#examples-and-challenge-questions" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this section, we will review a field based experimental design example. There are challenge questions to answer.</p>
<p>We will also introduce tools to generate randomised experimental designs - this is a good trick to have up your sleeves!</p>
<div id="designing-your-first-experiment" class="section level2 hasAnchor" number="4.1">
<h2 class="hasAnchor"><span class="header-section-number">4.1</span> Designing your first experiment<a href="#designing-your-first-experiment" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You are challenged to design an Arctic field manipulation experiment to evalauate UV-B radiation and increased CO2 impacts on plant growth.</p>
<p>Context: an arctic tundra study
Increasing ultraviolet-B (+UV-B) radiation from ozone depletion (the arctic ozone hole)
Increasing atmospheric CO2 (+CO2) from anthropogenic emissions
For plants: +UV-B potentially harmful, +CO2 potentially beneficial</p>
<p>Hypotheses
Elevated (+) UV-B radiation will reduce the growth of arctic plants
Elevated (+) <span class="math inline">\(CO_{2}\)</span> will increase the growth of arctic plants</p>
<p><img src="images/ArcticPlants.png" width="241" /></p>
<p>The resources available to you are constrained. The arctic research station has given permission for 16 plots (each 2m x 2m) in the natural vegetation nearby.</p>
<p>One +UV-B plot (2m x 2m) costs £4000 (this provides the UV-B lamps, frame, power and control system, wooden walkways around the plots)
One <span class="math inline">\(+CO_{2}\)</span> plot (2m x 2m) costs £6000 (this provides a CO2 release system, CO2 control and covers CO2 purchase costs, wooden walkways around the plots)
One control plot (2m x 2m) costs £200 (marking posts, wooden walkways around the plots)</p>
<p>You have a budget of £61,000</p>
<p>Design an experiment to test the hypotheses (i.e. the design of the plots and treatments including replication, not what measurements you will take - which will be plant growth rates….). Think hard about this. How many treatments do you have? How many plots/treatment would you like to allocate? Is this possible? Will this be a balanced design, given your max budget? If it isn’t, what rule can you use to allocate them replicates to treatments?</p>
<p>Write an answer down, before moving to the next section. We’ll provide the answer separately!</p>
</div>
<div id="using-r-to-generate-experimental-designs" class="section level2 hasAnchor" number="4.2">
<h2 class="hasAnchor"><span class="header-section-number">4.2</span> Using R to generate Experimental Designs<a href="#using-r-to-generate-experimental-designs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This is the place to stop for a moment and organise your R-course life. My suggestion is to do the following.</p>
<p>Create an Experimental Design folder on your computer. Put a data folder inside that. Use RStudio to create an RStudio Project file inside the Experimental Design folder. This will be the only place you need to focus for this mini-module.</p>
<p>Now, let’s set up a script to do build this experimental design and actually generate soome data and do an analysis.</p>
<p>As with every script last semester, we start with a preamble and some libraries</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Designing experiments with R: and introduction</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># MY NAME</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># DATE</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#libraries I need</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(agricolae)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gmodels)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visreg)</span></code></pre></div>
<p>That’s alot of packages, but you’ll see how we use them for designing and then analysing data.</p>
<p>To design and experiment, we are going to use the <code>design.csd</code> function from the <em>agricolae</em> package, which we used last term to help with the tukey tests. It does WAY MORE!</p>
<p>This package has a great online help resource: <a href="https://myaseen208.github.io/agricolae/articles/Intro_agricolae.html" class="uri">https://myaseen208.github.io/agricolae/articles/Intro_agricolae.html</a></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use this to make sure the random allocation pattern created for the design is the same for you and me</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># define the treatments</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>treatments <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Control&quot;</span>,<span class="st">&quot;UVB&quot;</span>,<span class="st">&quot;CO2&quot;</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># define the design (this does some randomisation for you!)</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">design.crd</span>(treatments, <span class="at">r =</span> <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">5</span>,<span class="dv">5</span>), <span class="at">serie =</span> <span class="dv">0</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># view the design - note that the actual data are in $book</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(design)</span></code></pre></div>
<pre><code>## List of 2
##  $ parameters:List of 7
##   ..$ design: chr &quot;crd&quot;
##   ..$ trt   : chr [1:3] &quot;Control&quot; &quot;UVB&quot; &quot;CO2&quot;
##   ..$ r     : num [1:3] 5 6 5
##   ..$ serie : num 0
##   ..$ seed  : int 515190382
##   ..$ kinds : chr &quot;Super-Duper&quot;
##   ..$       : logi TRUE
##  $ book      :&#39;data.frame&#39;:  16 obs. of  3 variables:
##   ..$ plots     : num [1:16] 1 2 3 4 5 6 7 8 9 10 ...
##   ..$ r         : int [1:16] 1 1 1 2 2 2 3 3 4 3 ...
##   ..$ treatments: chr [1:16] &quot;UVB&quot; &quot;CO2&quot; &quot;Control&quot; &quot;UVB&quot; ...</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># grab that book</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>use_design <span class="ot">&lt;-</span> design<span class="sc">$</span>book</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># show the design</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>use_design</span></code></pre></div>
<pre><code>##    plots r treatments
## 1      1 1        UVB
## 2      2 1        CO2
## 3      3 1    Control
## 4      4 2        UVB
## 5      5 2        CO2
## 6      6 2    Control
## 7      7 3        CO2
## 8      8 3        UVB
## 9      9 4        CO2
## 10    10 3    Control
## 11    11 4        UVB
## 12    12 4    Control
## 13    13 5    Control
## 14    14 6    Control
## 15    15 5        CO2
## 16    16 5        UVB</code></pre>
<p>Great scott! So, we have 16 plots and we’ve randomly allocated the set of treatments to these plots, with 6 controls, and 5 of the non-control treatments. This is just what we wanted.</p>
<p>Time to move on to the next chapter, but stick with this script! We will come back to this example later.</p>
<!--chapter:end:04-Some_Examples_and_a_Challenge.Rmd-->
</div>
</div>
<div id="design-and-analysis-of-experiments" class="section level1 hasAnchor" number="5">
<h1 class="hasAnchor"><span class="header-section-number">5</span> Design and Analysis of Experiments<a href="#design-and-analysis-of-experiments" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this section, we will design and experiment, make up data for the experiment, and analyse the experiment.</p>
<p>This is a very good process to go through - you will understand more fully how to generate randomisation in your experiments, and you will better understand how data that you collect is <em>structured</em> - from where does variation come in your measurements.</p>
<p>Another way to think about this is to consider that we are learning how statistics looks at data you’ve collected. We are going to make up data, where we know the answer to the question. Then we are going to plot these data, and analyse them.</p>
<div id="example-one" class="section level2 hasAnchor" number="5.1">
<h2 class="hasAnchor"><span class="header-section-number">5.1</span> Example one<a href="#example-one" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We are now going to cheat by generating artificial data we we don’t have time to go run the experiment.</p>
<p>The experiment is about plant biomass yield under several herbicide treatments: a control and two herbicides, and a third treatment that is a placebo - applied water but no herbicide. The hypothesis is….?</p>
<p>Start a new section of your script (some hashes) called Herbicide Example.</p>
<p>Now, enter the following code in your script file, then run it.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set the random seed - this will ensure that your results and mine here are the same.</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#treatment names we have a control and two herbicides, Herb3 is a placebo (applied water but no herbicide)</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>treat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Cont&quot;</span>,<span class="st">&quot;Herb1&quot;</span>,<span class="st">&quot;Herb2&quot;</span>,<span class="st">&quot;Placebo&quot;</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#number of replicates</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>Nreps <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Total number of experimental units</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>Total.units <span class="ot">&lt;-</span> Nreps <span class="sc">*</span> <span class="fu">length</span>(treat)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Our completely randomized design</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co"># not the trick of adding the $book at the end of the code</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">design.crd</span>(treat, Nreps, <span class="at">serie =</span> <span class="dv">0</span>)<span class="sc">$</span>book</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co"># check it out (the first 10 rows)</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(design, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##    plots r   treat
## 1      1 1    Cont
## 2      2 1   Herb1
## 3      3 2   Herb1
## 4      4 1 Placebo
## 5      5 2 Placebo
## 6      6 3 Placebo
## 7      7 3   Herb1
## 8      8 2    Cont
## 9      9 1   Herb2
## 10    10 2   Herb2</code></pre>
<div id="making-up-data" class="section level3 hasAnchor" number="5.1.1">
<h3 class="hasAnchor"><span class="header-section-number">5.1.1</span> Making up data<a href="#making-up-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Right, lets make up some artificial data so we know the right answers – this is a very good way of checking you understand what’s going on.</p>
<p>First, lets define some randon variation centred around 0 with a standard deviation of 3:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Our experimental errors, normal distribution mean = 0, standard deviation = 3</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># rnorm is random normal distribution - the bell curve!</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(Total.units, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="dv">3</span>)</span></code></pre></div>
<p>Now we need to actually generate a response variable. The thing we ‘measured’. For this experiment we are <em>measuring</em> yield - the grams of dry biomass at the end of the experimental season.</p>
<p>To do this, we have to think about the mean of the yield (we’ll set it to 20), the deviation caused by Herbicide 1 (+5 average yield), the deviation caused by Herbicide 2 (+6 average yield) and the deviation caused by the placebo (nothing) and the error among observations (error). If this works, there should be Controls and Placebos with values around 20, and Herbicide values around ±25-26. But keep in mind… we have a standard deviation of 3 in the error… what will that do? Let’s see.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#the observations of yield</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>design<span class="sc">$</span>obs <span class="ot">&lt;-</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mean yield Control</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">20</span> <span class="sc">+</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># deviation caused by Herbicide 1</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  (design<span class="sc">$</span>treat<span class="sc">==</span><span class="st">&quot;Herb1&quot;</span>) <span class="sc">*</span> <span class="dv">5</span> <span class="sc">+</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  (design<span class="sc">$</span>treat <span class="sc">==</span> <span class="st">&quot;Herb2&quot;</span>) <span class="sc">*</span> <span class="dv">6</span> <span class="sc">+</span> </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  (design<span class="sc">$</span>treat <span class="sc">==</span> <span class="st">&quot;Placebo&quot;</span>)<span class="sc">*</span><span class="dv">1</span> <span class="sc">+</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  error</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># look at it</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>design<span class="sc">$</span>obs</span></code></pre></div>
<pre><code>##   [1] 25.56702 23.32992 23.39985 21.54529 20.96267 22.34314 24.19572 15.45247
##   [9] 28.25849 28.09586 25.03735 26.36961 20.44643 16.30186 25.99108 29.62076
##  [17] 24.05645 22.01011 25.48992 29.60826 25.83590 23.77995 21.06598 21.85137
##  [25] 19.10903 20.54631 21.71607 24.78175 15.84089 24.56500 26.21161 19.96028
##  [33] 16.21851 24.50682 17.80657 23.74981 30.64518 24.90522 27.33204 18.15174
##  [41] 13.41104 27.87253 19.64131 22.48390 25.17527 15.41037 16.58438 15.85613
##  [49] 20.56557 20.75066 19.84848 19.97868 22.47068 25.11759 25.55048 24.92058
##  [57] 18.45873 22.02616 23.09377 15.56172 26.78291 18.20024 21.20411 25.58635
##  [65] 25.67710 26.29930 22.20238 20.63010 30.71839 18.37104 29.64641 14.20080
##  [73] 30.80997 22.67665 29.92778 20.63348 21.45997 20.32328 25.25901 18.08680
##  [81] 18.75511 24.83941 27.00049 23.06356 27.87863 18.63813 16.75083 24.45870
##  [89] 19.76979 23.40537 21.49970 21.09057 18.48304 18.64256 23.66625 28.52046
##  [97] 18.82317 29.38274 22.55174 26.41338 25.95806 24.86078 21.90836 20.61218
## [105] 25.47680 21.99004 23.06115 20.40581 15.70540 23.30232 28.04868 18.26389
## [113] 30.76203 24.50311 19.17553 25.11028 26.65809 18.84203 26.01325 26.79324</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># look at the design now.</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(design)</span></code></pre></div>
<pre><code>##   plots r   treat      obs
## 1     1 1    Cont 25.56702
## 2     2 1   Herb1 23.32992
## 3     3 2   Herb1 23.39985
## 4     4 1 Placebo 21.54529
## 5     5 2 Placebo 20.96267
## 6     6 3 Placebo 22.34314</code></pre>
</div>
<div id="into-the-dplyr-and-ggplot-pipeline." class="section level3 hasAnchor" number="5.1.2">
<h3 class="hasAnchor"><span class="header-section-number">5.1.2</span> Into the dplyr and ggplot pipeline.<a href="#into-the-dplyr-and-ggplot-pipeline." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Great stuff. Now we can move to our standard data management and visualisation pipeline.</p>
<ol style="list-style-type: decimal">
<li>review the data</li>
<li>sumamrise the data with dplyr - generate means and se’s for the treatments</li>
<li>visualise with ggplot2</li>
</ol>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the data</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(design)</span></code></pre></div>
<pre><code>## Rows: 120
## Columns: 4
## $ plots &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 1…
## $ r     &lt;int&gt; 1, 1, 2, 1, 2, 3, 3, 2, 1, 2, 3, 4, 4, 4, 5, 5, 6, 3, 5, 6, 7, 8…
## $ treat &lt;chr&gt; &quot;Cont&quot;, &quot;Herb1&quot;, &quot;Herb1&quot;, &quot;Placebo&quot;, &quot;Placebo&quot;, &quot;Placebo&quot;, &quot;Herb…
## $ obs   &lt;dbl&gt; 25.56702, 23.32992, 23.39985, 21.54529, 20.96267, 22.34314, 24.1…</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summarise to get means and ses</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>sumDat <span class="ot">&lt;-</span> design <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treat) <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">meanYield =</span> <span class="fu">mean</span>(obs),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">seYield =</span> <span class="fu">sd</span>(obs)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">n</span>())</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the raw data and the mean±se</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># start with the mean±se and then add the raw data</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sumDat, <span class="fu">aes</span>(<span class="at">x =</span> treat, <span class="at">y =</span> meanYield))<span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">data =</span> sumDat, <span class="fu">aes</span>(<span class="at">ymin =</span> meanYield <span class="sc">-</span> seYield, <span class="at">ymax =</span> meanYield<span class="sc">+</span>seYield),</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> design, <span class="fu">aes</span>(<span class="at">x =</span> treat, <span class="at">y =</span> obs), <span class="at">colour =</span> <span class="st">&#39;red&#39;</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<p><img src="Experimental-Design,-ANOVA-and-ANCOVA_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>A few things to notice.</p>
<ol style="list-style-type: decimal">
<li>The data are quite variable and the means of the herbicide treatments are roughly 5 and 6 units higher. This is as we expected….</li>
<li>The standard errors are quite small! Why is that!?</li>
<li>For those of you interested in some extra reading and thinking, the 95% Confidence Interval around the means can be calculated using <code>1.96*SE</code> == <code>1.96*sd(obs)/sqrt(n())</code>. Go ahead and do that and look into that if you want…</li>
</ol>
</div>
</div>
<div id="the-one-way-anova." class="section level2 hasAnchor" number="5.2">
<h2 class="hasAnchor"><span class="header-section-number">5.2</span> The One-Way ANOVA.<a href="#the-one-way-anova." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If you’ve been paying attention, we’ve essentially designed and plotted the data for a 1-way ANOVA. These data are very similar to the daphnia parasite data we finished semester 1 with.</p>
<p>To analyse these data, we use the <code>lm()</code> function to build the model, check assumptions, and then make inference. Let’s go.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the model</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>modYield <span class="ot">&lt;-</span> <span class="fu">lm</span>(obs <span class="sc">~</span> treat, <span class="at">data =</span> design)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># assumptions</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(modYield)</span></code></pre></div>
<p><img src="Experimental-Design,-ANOVA-and-ANCOVA_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># inference: anova</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(modYield)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: obs
##            Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
## treat       3  888.39 296.129  31.968 3.905e-15 ***
## Residuals 116 1074.54   9.263                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># contrasts</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modYield)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = obs ~ treat, data = design)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -6.5589 -1.8698  0.1395  2.0230  6.3494 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   19.6087     0.5557  35.288  &lt; 2e-16 ***
## treatHerb1     5.1019     0.7858   6.492 2.18e-09 ***
## treatHerb2     6.5048     0.7858   8.277 2.43e-13 ***
## treatPlacebo   0.9993     0.7858   1.272    0.206    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.044 on 116 degrees of freedom
## Multiple R-squared:  0.4526, Adjusted R-squared:  0.4384 
## F-statistic: 31.97 on 3 and 116 DF,  p-value: 3.905e-15</code></pre>
<div id="making-insight-and-inference" class="section level3 hasAnchor" number="5.2.1">
<h3 class="hasAnchor"><span class="header-section-number">5.2.1</span> Making insight and inference<a href="#making-insight-and-inference" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Lets walks through things very discretely.</p>
<ol style="list-style-type: decimal">
<li>Our graph suggests that herbicide treatments have an effect of increasing yield.</li>
<li>Our model is designed to test this hypothesis - are any of the differences among means non-zero?</li>
<li>Our hypothesis is probably really about whether the herbicide and placebos are differnt than the controls</li>
<li>Our diagnostics are fantistic… the best you’ve ever seen.</li>
<li>The Anova Table confirms that there are differences - we can reject the null hypothesis</li>
<li>The summary table confirms that Herb1 and Herb2 are both larger than controls and the Placebo is not.</li>
</ol>
<p>How do we interpret even more? The estimate associated with Control is 20! Just where it should be.</p>
<p>The estimates associated with Herb1, Herb2 and Placebo are the differences between the mean of these treatments and the control (the reference level!). These differences are positive for Herb1 and Herb2, close to 5 and 6 respectively (as expected) and this positive difference is not 0 via the statistical test.</p>
<p>However, the differnce for Placebo is close to 0 and therefore we can not reject the null hypothesis test that it differs from control. GENUIS!</p>
</div>
</div>
<div id="a-priori-vs.-post-hoc-contrasts" class="section level2 hasAnchor" number="5.3">
<h2 class="hasAnchor"><span class="header-section-number">5.3</span> A priori vs. Post-Hoc Contrasts<a href="#a-priori-vs.-post-hoc-contrasts" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the semester 1, we introduced how to do a Tukey Test.</p>
<p>This is known as an <em>a posteriori</em> test – testing the significance of things suggested by the experiment, also known as data snooping or data dredging. These are multiple comparison methods (Bonferroni, Scheffe method, Tukey honest significant difference, Duncan’s multiple range test) which try to control the chance of getting a significant result by chance.</p>
<p>To understand the risks of these, consider this experimental design. We have 7 treatments. With 7 treatments, there are 21 pairwise comparisons. With p-value threshold of <span class="math inline">\(0.05\)</span> we expect 1/20 (5/100) tests to be significant. So with this 7 treatment and 21 comparison design, would you expect a signficant result by chance? You betyja.</p>
<p>This is why, unless a priori (in advance) you can justify ALL pairwise comparisons, a tukey test may not be appropriate.</p>
<p>Some statisticians really don’t like them “In my view multiple comparison methods have no place at all in the interpretation of data” Nelder (very well respected statistician).</p>
<div id="the-more-appropriate-approach." class="section level3 hasAnchor" number="5.3.1">
<h3 class="hasAnchor"><span class="header-section-number">5.3.1</span> The more appropriate approach.<a href="#the-more-appropriate-approach." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The classical approach is to specify a priori (before experiment) a set of hypotheses then test them using contrasts. For our experiment, as noted above, we were probably interested in what our treatment contrasts provided - tests of difference with the control.</p>
<p>Specifying specific contrasts is easy once you get your head around the ‘structure’ of the syntax. Lets have a go with specifying a comparison JUST between Herbicide 1 and the control.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the levels and ORDERING of the treatments</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(design<span class="sc">$</span>treat)</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define the contrast you want using -1, 1 and 0&#39;s</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># this says compare control with herbicide 1.... and ignore the Herb2 and Placebo</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># we give the reference -1 and the &#39;other&#39; 1.</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>contrast <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># use the fit.contrast function from gmodels</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">fit.contrast</span>(modYield, <span class="st">&quot;treat&quot;</span>, contrast)</span></code></pre></div>
<pre><code>##                      Estimate Std. Error  t value     Pr(&gt;|t|)
## treat c=( -1 1 0 0 ) 5.101935  0.7858436 6.492304 2.181992e-09
## attr(,&quot;class&quot;)
## [1] &quot;fit_contrast&quot;</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remind ourselves of the contrast from the summary table</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modYield)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = obs ~ treat, data = design)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -6.5589 -1.8698  0.1395  2.0230  6.3494 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   19.6087     0.5557  35.288  &lt; 2e-16 ***
## treatHerb1     5.1019     0.7858   6.492 2.18e-09 ***
## treatHerb2     6.5048     0.7858   8.277 2.43e-13 ***
## treatPlacebo   0.9993     0.7858   1.272    0.206    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.044 on 116 degrees of freedom
## Multiple R-squared:  0.4526, Adjusted R-squared:  0.4384 
## F-statistic: 31.97 on 3 and 116 DF,  p-value: 3.905e-15</code></pre>
<blockquote>
<p>Notice that the results are the same from the summary(modYield) and the fit.contrast.</p>
</blockquote>
<p>If we want to compare the two herbicides we can use this approach. Note in advance that this contrast DOES NOT exist in the summary table!</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define the contrast you want using -1, 1 and 0&#39;s</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># this says compare herb1 with herb2, ignoring the control and placebo.</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># we give the reference -1 and the &#39;other&#39; 1.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>contrast <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># use the fit.contrast function from gmodels</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="fu">fit.contrast</span>(modYield, <span class="st">&quot;treat&quot;</span>, contrast)</span></code></pre></div>
<pre><code>##                      Estimate Std. Error  t value   Pr(&gt;|t|)
## treat c=( 0 -1 1 0 ) 1.402879  0.7858436 1.785189 0.07684408
## attr(,&quot;class&quot;)
## [1] &quot;fit_contrast&quot;</code></pre>
<p>Isn’t this cool? Note that the difference reported is the difference between the two means:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check our summary data</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>sumDat</span></code></pre></div>
<pre><code>## # A tibble: 4 × 3
##   treat   meanYield seYield
##   &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;
## 1 Cont         19.6   0.580
## 2 Herb1        24.7   0.545
## 3 Herb2        26.1   0.546
## 4 Placebo      20.6   0.552</code></pre>
<p>Here it is: <span class="math inline">\(26.2 - 24.2 = 2\)</span></p>
<p>This says that despite the difference we created of ~1 unit of yield between Herb1 and Herb2, when we defined error and generated the data, it created a significant difference detectable with statistics.</p>
</div>
<div id="comparing-the-average-of-the-herbicide-effect-with-the-control." class="section level3 hasAnchor" number="5.3.2">
<h3 class="hasAnchor"><span class="header-section-number">5.3.2</span> comparing the average of the herbicide effect with the control.<a href="#comparing-the-average-of-the-herbicide-effect-with-the-control." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This might be a comparison you intended to make also… the average effect of herbicides in general. To do this, we expand the idea of -1,1 and 0’s to include 1/2s (and yes, 1/3’s and more are possible):</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define the contrast you want using -1, 1 and 0&#39;s</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># this says compare control with the average of herbicide 1 and 2, ignoring the placebo</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># we give the reference -1 and the &#39;other two&#39; a 1/2 each.</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>contrast <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,<span class="dv">0</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># use the fit.contrast function from gmodels</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">fit.contrast</span>(modYield, <span class="st">&quot;treat&quot;</span>, contrast)</span></code></pre></div>
<pre><code>##                          Estimate Std. Error  t value     Pr(&gt;|t|)
## treat c=( -1 0.5 0.5 0 ) 5.803375  0.6805605 8.527346 6.484593e-14
## attr(,&quot;class&quot;)
## [1] &quot;fit_contrast&quot;</code></pre>
<p>Again, checking sumDat</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>sumDat</span></code></pre></div>
<pre><code>## # A tibble: 4 × 3
##   treat   meanYield seYield
##   &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;
## 1 Cont         19.6   0.580
## 2 Herb1        24.7   0.545
## 3 Herb2        26.1   0.546
## 4 Placebo      20.6   0.552</code></pre>
<p><span class="math inline">\((24.2+26.2)/2 = 25.2\)</span> –&gt; <span class="math inline">\(25.2 - 20 = 5.2\)</span></p>
</div>
<div id="writing-this-up" class="section level3 hasAnchor" number="5.3.3">
<h3 class="hasAnchor"><span class="header-section-number">5.3.3</span> writing this up…<a href="#writing-this-up" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Fill in these blanks using the various contrasts you made above!</p>
<blockquote>
<p>We conclude that herbicides on average cause an _____ gram increase in yield (t = ___ , p = ___ ). We also note that there was a significant difference of _____ grams between the herbicides (t = _____ p = ______). The additional placebo treatment had no effect on yield (t = _______ p = __________).</p>
</blockquote>
<!--chapter:end:05-Design_and_Analysis_of_a_CRD.Rmd-->
</div>
</div>
</div>
<div id="randomized-complete-block-design-rcb" class="section level1 hasAnchor" number="6">
<h1 class="hasAnchor"><span class="header-section-number">6</span> Randomized Complete Block design (RCB)<a href="#randomized-complete-block-design-rcb" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Blocking allows us to reduce the experimental error.</p>
<p>A block is a group of experimental units that are homogeneous in some sense – in the same place, or measured at the same time, or by the same person. So when constructing blocks we try and select experimental units that are homogeneous within blocks but units in different blocks may be dissimilar.</p>
<p>Why block? When we use a completely randomised design, the location or timing of our treatment ‘plots’ (patches, incubators, locations in a 96 well plate) can generate heterogeneity in experimental error (variation). As the variance of the Experimental Error increases, confidence intervals get wider and the power of our analysis decreases - it’s harder to detect effects of our treatments against the background noise. Ideally we would like to use experimental units that are homogeneous so the experimental error will be small. Blocking does this.</p>
<p>The simplest blocked design is the <strong>Randomized Complete Block design (RCB)</strong></p>
<p>We have one complete set of treatments in each block. Say you have g Treatments and r Blocks then the total number of experimental units is?</p>
<p>In the first block, we randomly assign the g treatments to the n units; we do an independent randomization, assigning treatments to units in each of the other blocks. This is the RCB design.</p>
<p>For example, consider the following matrix: the rows are the blocks, the letters the different treatments. In each block, each treatment is represented, but it is in a different location in the block (randomisation of the g treatments in the n units). The blocks are in a sequence - left to right - this could be different days, different locations or different positions on a hillside, for example representing an elevation or soil moisture gradient.</p>
<p>The Blocks are designed to ‘capture’ that underlying source of variability and allow us to detect among treatment differences more effectively.</p>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,] &quot;A&quot;  &quot;B&quot;  &quot;A&quot;  &quot;E&quot;  &quot;D&quot; 
## [2,] &quot;C&quot;  &quot;A&quot;  &quot;D&quot;  &quot;C&quot;  &quot;A&quot; 
## [3,] &quot;D&quot;  &quot;E&quot;  &quot;B&quot;  &quot;D&quot;  &quot;C&quot; 
## [4,] &quot;E&quot;  &quot;C&quot;  &quot;E&quot;  &quot;B&quot;  &quot;E&quot; 
## [5,] &quot;B&quot;  &quot;D&quot;  &quot;C&quot;  &quot;A&quot;  &quot;B&quot;</code></pre>
<p>Here is another picture of a block design that moves from just letters to something more literal.</p>
<p><img src="images/BlockDesignGraphic.png" width="320" /></p>
<p>The blocks are arranged along a gradient, say along the side of a hill, so represent low and high elevation and associated soil moisture. The blocks capture this background variation. THEN, each treatment level (1-4) is allocated a random position in each block.  In the end, each treatment level is replicated across blocks (n = 6!). From: <a href="https://www.researchgate.net/publication/322369242_Randomized_Block_Design_probiotic_example/figures?lo=1" class="uri">https://www.researchgate.net/publication/322369242_Randomized_Block_Design_probiotic_example/figures?lo=1</a></p>
<p>It is important to note that blocks exist at the time of the randomization of treatments to units. We cannot impose blocking structure on a completely randomized design after the fact; either the randomization was blocked or it was not.</p>
<p>We use an RCB to increase the power and precision of an experiment by decreasing the error variance. This decrease in error variance is achieved by finding groups of units that are homogeneous (blocks) and, in effect, repeating the experiment independently in the different blocks. The RCB is an effective design when there is a single source of extraneous variation in the responses that we can identify ahead of time and use to partition the units into blocks.</p>
<p>In short ALWAYS block your experiment, if you can.</p>
<p>You can have spatial blocks, or temporal blocks where you repeat the experiment at different times, or block by batch.</p>
<p>In general, any source of variation that you think may influence the response and which can be identified prior to the experiment is a candidate for blocking.</p>
<div id="an-example-of-the-rcbd" class="section level2 hasAnchor" number="6.1">
<h2 class="hasAnchor"><span class="header-section-number">6.1</span> An example of the RCBD<a href="#an-example-of-the-rcbd" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Lets modify our previous example to including blocking. Start another section with some ## and call it Blocking Example.</p>
<p>Of course, if you want to start another script, you can, but make sure you include all of the library()’s again!</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Randomised Complete Block Design</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ensure allocation is the same</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># define the treatments</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>treat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Control&quot;</span>,<span class="st">&quot;Herb1&quot;</span>,<span class="st">&quot;Herb2&quot;</span>,<span class="st">&quot;Placebo&quot;</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co"># define the number of blocks</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>Nblocks <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co"># consider this</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>Total.units <span class="ot">&lt;-</span> Nblocks <span class="sc">*</span> <span class="fu">length</span>(treat)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co"># build the design</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">design.rcbd</span>(treat, Nblocks, <span class="at">serie =</span> <span class="dv">0</span>)<span class="sc">$</span>book</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="co"># look at it</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>design</span></code></pre></div>
<pre><code>##    plots block   treat
## 1     11     1 Placebo
## 2     12     1 Control
## 3     13     1   Herb2
## 4     14     1   Herb1
## 5     21     2 Control
## 6     22     2   Herb1
## 7     23     2   Herb2
## 8     24     2 Placebo
## 9     31     3   Herb2
## 10    32     3   Herb1
## 11    33     3 Control
## 12    34     3 Placebo
## 13    41     4 Control
## 14    42     4   Herb2
## 15    43     4 Placebo
## 16    44     4   Herb1
## 17    51     5 Placebo
## 18    52     5 Control
## 19    53     5   Herb1
## 20    54     5   Herb2</code></pre>
<p>This is like the matrix above, but in tidy format! Excellent. This is how a block design looks in tidy-land.</p>
<p>Now, lets generate some data again.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed again ... </span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># define the error - note how we use the variable Total.units to get the number of observations</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(Total.units, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>) <span class="co"># is this more or less variation than before?</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co"># generate the observations</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co"># note that we are now generating larger differences (10 and 9) among treatments</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co"># e.g. Herb1 is 10 units larger than the control.</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>design<span class="sc">$</span>obs <span class="ot">&lt;-</span> <span class="dv">20</span> <span class="sc">+</span> </span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  (design<span class="sc">$</span>treat<span class="sc">==</span><span class="st">&quot;Herb1&quot;</span>) <span class="sc">*</span> <span class="dv">10</span> <span class="sc">+</span> </span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  (design<span class="sc">$</span>treat <span class="sc">==</span> <span class="st">&quot;Herb2&quot;</span>) <span class="sc">*</span> <span class="dv">9</span> <span class="sc">+</span> </span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  (design<span class="sc">$</span>treat <span class="sc">==</span> <span class="st">&quot;Placebo&quot;</span>) <span class="sc">*</span> <span class="dv">1</span> <span class="sc">+</span> </span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># note that we are defining variation among blocks here</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># block 1 is on average 10 units higher.... and block 5 is now 10 units lower...</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  (design<span class="sc">$</span>block<span class="sc">==</span><span class="dv">1</span>) <span class="sc">*</span> <span class="dv">10</span> <span class="sc">-</span> </span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  (design<span class="sc">$</span>block<span class="sc">==</span><span class="dv">5</span>) <span class="sc">*</span> <span class="dv">10</span> <span class="sc">+</span> </span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># now add the error variation</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  error</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(design, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##    plots block   treat      obs
## 1     11     1 Placebo 31.18707
## 2     12     1 Control 31.99603
## 3     13     1   Herb2 41.29937
## 4     14     1   Herb1 41.12746
## 5     21     2 Control 21.08111
## 6     22     2   Herb1 30.56917
## 7     23     2   Herb2 28.09290
## 8     24     2 Placebo 21.02990
## 9     31     3   Herb2 27.44097
## 10    32     3   Herb1 30.29749</code></pre>
</div>
<div id="analysing-the-crbd" class="section level2 hasAnchor" number="6.2">
<h2 class="hasAnchor"><span class="header-section-number">6.2</span> Analysing the CRBD<a href="#analysing-the-crbd" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I’ll leave it to you now to generate the following plot of the means ± standard errors.</p>
<p>This requires thinking hard about the use of dplyr tools (<code>group_by()</code> and <code>summarise()</code>) and ggplot (adding more than one layer from two different sources of data - the summary data and the raw data). You need to make a <em>sumDat</em> object for the means and se’s. Then you need to plot the raw data, and overlay the mean±se info from the sumDat.</p>
<p>Can you see the variation we generated between block 1 and 5? Block 2-4 are all similar…. Block 1 is 10 units more, and Block 5 is 10 units less.</p>
<pre><code>## Rows: 20
## Columns: 4
## $ plots &lt;dbl&gt; 11, 12, 13, 14, 21, 22, 23, 24, 31, 32, 33, 34, 41, 42, 43, 44, …
## $ block &lt;fct&gt; 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5
## $ treat &lt;fct&gt; Placebo, Control, Herb2, Herb1, Control, Herb1, Herb2, Placebo, …
## $ obs   &lt;dbl&gt; 31.18707, 31.99603, 41.29937, 41.12746, 21.08111, 30.56917, 28.0…</code></pre>
<p><img src="Experimental-Design,-ANOVA-and-ANCOVA_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<div id="building-the-model" class="section level3 hasAnchor" number="6.2.1">
<h3 class="hasAnchor"><span class="header-section-number">6.2.1</span> Building the model<a href="#building-the-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In order to understand what’s going on with blocking, and it’s importance, lets build the naive model that ignores block - treating this as a CRB - and the correct model, letting block absorb some of the variation.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># models</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>naive_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(obs <span class="sc">~</span> treat, design)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>block_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(obs <span class="sc">~</span> block <span class="sc">+</span> treat, design) <span class="co"># note the order is important</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># anova tables</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(naive_model)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: obs
##           Df Sum Sq Mean Sq F value  Pr(&gt;F)  
## treat      3 417.82 139.274  2.5085 0.09579 .
## Residuals 16 888.34  55.521                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(block_model)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: obs
##           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## block      4 877.08 219.270  233.68 2.871e-11 ***
## treat      3 417.82 139.274  148.43 9.469e-10 ***
## Residuals 12  11.26   0.938                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The first important thing to focus on here is the difference in the Mean Sq Residual Errors - in the <code>naive_model</code>, it is <span class="math inline">\(55.52\)</span>. In the <code>block_model</code>, it is <span class="math inline">\(0.94\)</span>.</p>
<p>The second important thing to notice is that haveing allocated variation to block in the <code>block_model</code>, and thus reducing the error variation, the <em>treatment</em> effect shifts from being insignificant to significant.</p>
</div>
<div id="are-the-estimates-of-the-parameters-what-we-expect" class="section level3 hasAnchor" number="6.2.2">
<h3 class="hasAnchor"><span class="header-section-number">6.2.2</span> Are the estimates of the parameters what we expect?<a href="#are-the-estimates-of-the-parameters-what-we-expect" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Lets check that the model is estimating differences as we might have expected. We can do this using the summary table.</p>
<p>Let’s remember that, for example, the mean of Herb1 is expected to be 10 units higher than control with a yield of 20, and block 1 is supposed to be ~10 units higher than 2,3,4.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(block_model)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = obs ~ block + treat, data = design)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1.3505 -0.7196  0.2147  0.6396  1.0719 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   31.2184     0.6126  50.957 2.14e-15 ***
## block2       -11.2092     0.6850 -16.365 1.43e-09 ***
## block3       -12.1132     0.6850 -17.685 5.84e-10 ***
## block4       -11.3415     0.6850 -16.558 1.25e-09 ***
## block5       -20.8449     0.6850 -30.433 9.94e-13 ***
## treatHerb1    10.3450     0.6126  16.886 9.96e-10 ***
## treatHerb2     9.0721     0.6126  14.808 4.50e-09 ***
## treatPlacebo   1.3192     0.6126   2.153   0.0523 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.9687 on 12 degrees of freedom
## Multiple R-squared:  0.9914, Adjusted R-squared:  0.9864 
## F-statistic: 197.1 on 7 and 12 DF,  p-value: 2.009e-11</code></pre>
<p>In this table, the <em>INTERCEPT</em> is specifying the <strong>FIRST BLOCK</strong> and the <strong>CONTROL TREATMENT LEVEL</strong> - we know this because it’s these words that are missing from the rest of the table, and they are each the first alphanumerially in the list of blocks and treatments.</p>
<p>The value of the control, block 1 is approximately 30! Which is 20+10, which is what we expected.
The value of Herb1 is ~10 units higher than this (remember, the value 9.84 is the DIFFERENCE between the control and treatment)
And the value of block 5 is reported as 20 unites lower than block 1 control. This too is correct because, as above, block 1 control is 10 units higher than the control mean (20+10) and block 5 is 10 units lower….</p>
<p><em>Make sure you get this logic!</em></p>
<p>The take home message here is that these numbers from the model make complete sense with respect to the data that we simulated. Furthermore, controlling for the among block variation gave us more power to detect a treatment effect, something we would have missed had we not estimated the block source of variation.</p>
</div>
<div id="correct-standard-errors-for-a-figure" class="section level3 hasAnchor" number="6.2.3">
<h3 class="hasAnchor"><span class="header-section-number">6.2.3</span> Correct Standard Errors for a Figure<a href="#correct-standard-errors-for-a-figure" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When we made our initial plot above, we calculated the standard error based on all observations among blocks. However, the variation we really wish to represent is the variation after having controlled for the blocking effects.</p>
<p>This means that the standard deviation we should probably use is of the error variance from the correct model: <span class="math inline">\(0.94\)</span>.</p>
<p>The standard deviation is the <span class="math inline">\(\sqrt{Var}\)</span> and thus, our correct standard errors from the model are <span class="math inline">\(\sqrt{0.94}\)</span></p>
<p>There is a very nice plotting function in the package <em>visreg</em> that delivers these proper standard errors in a nice ggplot framework. It presents points that are the partial residuals (deviation from the mean for each replicate), lines depicting the means, and shaded area as a 95% confidence interval, calculated as 1.96*SE, where the SE is estimated from the model error variance (just above). Compare this to your first graph.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">visreg</span>(block_model, <span class="st">&quot;treat&quot;</span>, <span class="at">gg=</span><span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Yield&quot;</span>) <span class="sc">+</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Treatment&quot;</span>) </span></code></pre></div>
<p><img src="Experimental-Design,-ANOVA-and-ANCOVA_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
</div>
<div id="making-inference-confidence-intervals-and-contrasts" class="section level3 hasAnchor" number="6.2.4">
<h3 class="hasAnchor"><span class="header-section-number">6.2.4</span> Making inference: confidence intervals and contrasts<a href="#making-inference-confidence-intervals-and-contrasts" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We are now in a very strong position to make inference.</p>
<p>Let’s start with a rule of thumb linked to the 95% confidence interval. If the CIs don’t overlap, they are different; if they do, they are not. This indicates that Cont and Placebo are not significantly different (95% confidence intervals overlap). Herb1 and Herb 2 are significantly different from these, but not each other.</p>
<p>This is OK. But it’s not robust. Let’s revisit our <em>post-hoc</em> and <em>a priori</em> methods for evaluating differnces among treatments. We can apply a tukey test and calculate all pairwise differences. This is not a good idea, but let’s do it.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use agricolae HSD.test()</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>tukey_out <span class="ot">&lt;-</span> <span class="fu">HSD.test</span>(block_model, <span class="st">&quot;treat&quot;</span>, <span class="at">group =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>tukey_out<span class="sc">$</span>groups</span></code></pre></div>
<pre><code>##              obs groups
## Herb1   30.46167      a
## Herb2   29.18874      a
## Placebo 21.43581      b
## Control 20.11665      b</code></pre>
<p>This confirms our intuition and 95% Confidence Interval insights. But is it correct?</p>
<p>Let’s make a formal test of one of the pairwise tests that looks obvious - between Herb1 and Herb2</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit.contrast from gmodels package</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>contrast <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fit.contrast</span>(block_model, <span class="st">&quot;treat&quot;</span>, contrast)</span></code></pre></div>
<pre><code>##                       Estimate Std. Error   t value   Pr(&gt;|t|)
## treat c=( 0 -1 1 0 ) -1.272934  0.6126423 -2.077777 0.05985811
## attr(,&quot;class&quot;)
## [1] &quot;fit_contrast&quot;</code></pre>
<p>Amazing. The contrast defining a specific test provides a different answer than the post-hoc Tukey test and our guess based on the 95% CIs. Why is that? Which is right?</p>
<p>Of course the contrast is the correct and most reliable result. While both <em>fit.contrast</em> and <em>HSD.test</em> both manage the model complexity and variance estimates properly, only the contrast reduces the probability of finding a significant difference by chance or failing to find one.</p>
<!--chapter:end:06-The_Randomised_Block_Design.Rmd-->
</div>
</div>
</div>
<div id="designs-for-testing-for-interactions-factorial-designs." class="section level1 hasAnchor" number="7">
<h1 class="hasAnchor"><span class="header-section-number">7</span> Designs for testing for interactions: factorial designs.<a href="#designs-for-testing-for-interactions-factorial-designs." class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introducing-interactions" class="section level2 hasAnchor" number="7.1">
<h2 class="hasAnchor"><span class="header-section-number">7.1</span> Introducing Interactions<a href="#introducing-interactions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Before jumping into an example, let’s introduce a simple statement that forms the core of both asking and interpreting <em>interactions</em>.</p>
<p>If there is an interaction between two explanatory variables, X and Z, on our response variable Y, then:</p>
<blockquote>
<p>The effect of X on Y varies by Z. <strong>OR</strong> The effect of X on Y depends on Z.</p>
</blockquote>
<p>This use of <em>varies by</em> <strong>OR</strong> <em>depends on</em> defines context dependency and that’s what defines interactions.</p>
<p>Now, let’s return to our CO2 and UV-B solar radiation experiment in the Arctic Tundra example to introduce the idea of an interaction again.</p>
<p>Context: an arctic tundra study
Increasing ultraviolet-B (+UV-B) radiation from ozone depletion (the arctic ozone hole)
Increasing atmospheric CO2 (+CO2) from anthropogenic emissions
For plants: UV-B potentially harmful, +CO2 potentially beneficial
Therefore +CO2 could alleviate UV-B damage impacts.</p>
<p>Hypotheses
+UV-B radiation will reduce the growth of arctic plants
+CO2 will increase the growth of arctic plants
+UV-B radiation impacts will be less under +CO2</p>
<p>What is unique about these context and hypotheses? It’s the presentation of CO2 and UVB in the same statement and the use of words like “the effect of X will alleviate the impacts of Y” and words like “the effects of X will be less under Y”. These words and phrases reflect the context dependency of the effects of treatment levels.</p>
<p>Thus, to restate what we introduced above…. when we talk about interactions, we can rely on a very simple vocabulary that is independent of the actual treatment levels: we can always describe an interaction like this:</p>
<blockquote>
<p>The effect of X on Y depends on Z.</p>
</blockquote>
<p>or</p>
<blockquote>
<p>The effect of X on Y varies by Z.</p>
</blockquote>
<p>In this ‘rubric’, Y is the response variable, and X and Z are explanatory, independent variables. So, in our example above,</p>
<blockquote>
<p>the effect of CO2 on plant biomass yield depends on UV-B radiation levels.</p>
</blockquote>
<p>OR</p>
<blockquote>
<p>the effect of CO2 on plant biomass yield varies with UV-B radiation levels.</p>
</blockquote>
<p>This simple phrasing describes any interaction.</p>
<p>Here are some numerical examples to drive home the point.</p>
<p>Control = 20g Yield
UV-B = 10g Yield
C02 = 29g Yield</p>
<p>ADDITIVE RESULT: C02 + UV-B = 39g Yield
SYNERGISTIC RESULT: C02 + UV-B = 60g Yield
ANTAGONISTIC RESULT: C02 + UV-B = 19g Yield</p>
<div id="lets-design-an-experiment-again" class="section level3 hasAnchor" number="7.1.1">
<h3 class="hasAnchor"><span class="header-section-number">7.1.1</span> Let’s design an experiment, again…<a href="#lets-design-an-experiment-again" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Your resources:</p>
<p>The arctic research station has given permission for 16 plots (each 2m x 2m) in the natural vegetation nearby.
- One UV-B plot (2m x 2m) costs £4000 (this provides the UV-B lamps, frame, power and control system, wooden walkways around the plots)
- One CO2 plot (2m x 2m) costs £6000 (this provides a CO2 release system, CO2 control and covers CO2 purchase costs, wooden walkways around the plots)
- One control plot (2m x 2m) costs £200 (marking posts, wooden walkways around the plots)
- Yes, the CO2 supply system does fit underneath the UV-B lamps.</p>
<p>You have a budget of £86,000</p>
<p>Design an experiment to test the hypotheses. (An answer is on the BB Site)</p>
</div>
<div id="the-factorial-design-how-and-why-study-interactions" class="section level3 hasAnchor" number="7.1.2">
<h3 class="hasAnchor"><span class="header-section-number">7.1.2</span> The Factorial Design: How and Why Study Interactions?<a href="#the-factorial-design-how-and-why-study-interactions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The UV-B and C02 experiment could be thought of as two experiments – a Control vs UV-B and a Control vs C02 experiment. If we combine these we get a Factorial Experiment where the treatments are</p>
<ul>
<li>Control</li>
<li>UV-B</li>
<li>C02</li>
<li>UV-B + C02</li>
</ul>
<p>So we have all combinations of treatments.</p>
<p>But do we treat each of these as unique treatments (e.g. the one-way ANOVA example)? No, we don’t. We design and analyse the data we collect in a two-way analysis - a factorial design. Two-way ANOVA (and ANCOVA - see later), are the toolboxes.</p>
<p>Factorial treatments have two main advantages. When factors <em>DO interact</em> – so the effect of C02 depends on UV-B – then we can estimate the interaction - the dependency. <em>One-way designs</em> cannot do this, and can lead to serious misunderstandings (because we are assuming that the effect of one thing DOES NOT depend on the other).</p>
<p>Furthermore, when factors <em>DON’T interact</em>, <em>factorial designs</em> are more precise (smaller error variance) at estimating the main (non-interacting effects) than one-way designs experiments.</p>
<p>Hence ALWAYS use factorial designs when your experimental design contains the interaction!</p>
</div>
</div>
<div id="a-factorial-design-and-the-two-way-anova" class="section level2 hasAnchor" number="7.2">
<h2 class="hasAnchor"><span class="header-section-number">7.2</span> A Factorial Design and the Two-Way ANOVA<a href="#a-factorial-design-and-the-two-way-anova" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I’d recommend a new script now for this section. It’s a pretty distinct example. Don’t forget to use library() at the top to get all those packages working for this script. And don’t forget, this script can live in the same R Project as the other one(s).</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>Nreps <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="co"># 4 replicates per treatment level</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>trt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>) <span class="co"># sets out the 2-way design</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">design.ab</span>(trt, <span class="at">r=</span>Nreps, <span class="at">serie=</span><span class="dv">0</span>, <span class="at">design=</span><span class="st">&quot;crd&quot;</span>)<span class="sc">$</span>book</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co"># look at it.</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(design)</span></code></pre></div>
<pre><code>##   plots r A B
## 1     1 1 2 1
## 2     2 1 1 2
## 3     3 1 1 1
## 4     4 1 2 2
## 5     5 2 2 2
## 6     6 2 2 1</code></pre>
<p>So, the <code>design.ab</code> function generates a nice picture, but uses numbers instead of words for the various treatments and has set Letters as the treatments.</p>
<p>We don’t support this approach of using numbers to <em>code for</em> the actual treatment level names - you WILL forget what the numbers and letters mean. So let’s change these <em>codes</em> to represent the words “CO2” and “UVB” which are our reality.</p>
<p>We’ll use <code>fct_recode</code> from the tidyverse package called <code>forcats</code> (for categories, but we like cats) - this is part of the tidyverse, so if you’re using that, it’s just there!</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> design <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">UVB =</span> A, <span class="at">CO2 =</span> B) <span class="sc">%&gt;%</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">UVB =</span> <span class="fu">fct_recode</span>(UVB, <span class="st">&quot;Con&quot;</span> <span class="ot">=</span> <span class="st">&quot;1&quot;</span>, <span class="st">&quot;UVB+&quot;</span> <span class="ot">=</span> <span class="st">&quot;2&quot;</span>),</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">CO2 =</span> <span class="fu">fct_recode</span>(CO2, <span class="st">&quot;Con&quot;</span> <span class="ot">=</span> <span class="st">&quot;1&quot;</span>,<span class="st">&quot;CO2+&quot;</span> <span class="ot">=</span> <span class="st">&quot;2&quot;</span>))</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(design, <span class="dv">10</span>) <span class="co"># is this what you expect</span></span></code></pre></div>
<pre><code>##    plots r  UVB  CO2
## 1      1 1 UVB+  Con
## 2      2 1  Con CO2+
## 3      3 1  Con  Con
## 4      4 1 UVB+ CO2+
## 5      5 2 UVB+ CO2+
## 6      6 2 UVB+  Con
## 7      7 3 UVB+ CO2+
## 8      8 2  Con  Con
## 9      9 3  Con  Con
## 10    10 4  Con  Con</code></pre>
<blockquote>
<p>NOTE 1: this is using the <code>fct_recode</code> function from the <em>forcats</em> package in the <em>tidyverse</em> collection.</p>
</blockquote>
<blockquote>
<p>NOTE 2: we used the design = “crd” argument to specify a completely randomised, 2-way factorial design… you could make this a block design with the “rcbd”…. see the help file for <code>design.ab</code></p>
</blockquote>
<div id="build-the-data" class="section level3 hasAnchor" number="7.2.1">
<h3 class="hasAnchor"><span class="header-section-number">7.2.1</span> Build the Data<a href="#build-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here we will build two sources of data - one that has NO INTERACTION, and one that DOES.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Sample Sizes and errors</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>Total.units <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> Nreps <span class="co"># make sure you understand the 2*2 !!</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(Total.units,<span class="dv">0</span>,<span class="dv">3</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we make to sets of observations - obs and obs2</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co"># the data with no interaction (obs)</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>design<span class="sc">$</span>obs <span class="ot">&lt;-</span> <span class="dv">20</span> <span class="sc">-</span> </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  (design<span class="sc">$</span><span class="st">&quot;UVB&quot;</span><span class="sc">==</span><span class="st">&quot;UVB+&quot;</span>) <span class="sc">*</span> <span class="dv">10</span> <span class="sc">+</span> </span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  (design<span class="sc">$</span><span class="st">&quot;CO2&quot;</span> <span class="sc">==</span> <span class="st">&quot;CO2+&quot;</span>) <span class="sc">*</span> <span class="dv">9</span> <span class="sc">+</span> </span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>  error</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="co"># the data with interaction (obs2)</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>design<span class="sc">$</span>obs2 <span class="ot">&lt;-</span> <span class="dv">20</span> <span class="sc">-</span> </span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  (design<span class="sc">$</span><span class="st">&quot;UVB&quot;</span><span class="sc">==</span><span class="st">&quot;UVB+&quot;</span>) <span class="sc">*</span> <span class="dv">10</span> <span class="sc">+</span> </span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  (design<span class="sc">$</span><span class="st">&quot;CO2&quot;</span> <span class="sc">==</span> <span class="st">&quot;CO2+&quot;</span>) <span class="sc">*</span> <span class="dv">9</span> <span class="sc">+</span> </span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># when both are together add 8 more (synergy)</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this is the interaction.  the effect of UVB now depends on CO2.</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>  ((design<span class="sc">$</span><span class="st">&quot;UVB&quot;</span><span class="sc">==</span><span class="st">&quot;UVB+&quot;</span>) <span class="sc">&amp;</span> (design<span class="sc">$</span><span class="st">&quot;CO2&quot;</span> <span class="sc">==</span> <span class="st">&quot;CO2+&quot;</span>)) <span class="sc">*</span> <span class="dv">8</span> <span class="sc">+</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add the variation</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>  error</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(design)</span></code></pre></div>
<pre><code>##   plots r  UVB  CO2      obs     obs2
## 1     1 1 UVB+  Con 12.82805 12.82805
## 2     2 1  Con CO2+ 25.38908 25.38908
## 3     3 1  Con  Con 19.17974 19.17974
## 4     4 1 UVB+ CO2+ 25.85980 33.85980
## 5     5 2 UVB+ CO2+ 15.92984 23.92984
## 6     6 2 UVB+  Con  7.75704  7.75704</code></pre>
</div>
<div id="plot-the-data" class="section level3 hasAnchor" number="7.2.2">
<h3 class="hasAnchor"><span class="header-section-number">7.2.2</span> Plot the data!<a href="#plot-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here we combine some dplyr magic (calcuating means in each group - there are two grouping variables!), some ggplot magic (adding the lines connecting the means on top of the raw data) and the beauty of patchwork, the package for plot layouts.</p>
<p>Our goal here is to plot the data that does not have the interaction next to a plot of the data that does have the interaction.</p>
<p>Don’t forget to check that you’ve got all of the <code>library()</code> calls at the top of your script, and that you ran them!</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># No interaction summary</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>sumDat1 <span class="ot">&lt;-</span> design <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(UVB, CO2) <span class="sc">%&gt;%</span> </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">obs =</span> <span class="fu">mean</span>(obs)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co"># with interaction summary</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>sumDat2 <span class="ot">&lt;-</span> design <span class="sc">%&gt;%</span> </span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(UVB, CO2) <span class="sc">%&gt;%</span> </span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">obs2 =</span> <span class="fu">mean</span>(obs2)</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="co"># The two plots.</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="co"># no interaction</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(design, <span class="fu">aes</span>(<span class="at">x =</span> UVB, <span class="at">y =</span> obs, <span class="at">colour =</span> CO2, <span class="at">shape =</span> CO2, <span class="at">group =</span> CO2))<span class="sc">+</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> sumDat1)</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a><span class="co"># with interaction</span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(design, <span class="fu">aes</span>(<span class="at">x =</span> UVB, <span class="at">y =</span> obs2, <span class="at">colour =</span> CO2, <span class="at">shape =</span> CO2, <span class="at">group =</span> CO2))<span class="sc">+</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> sumDat2)</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a><span class="co"># use patchwork to put them side-by-side.</span></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span>p2</span></code></pre></div>
<p><img src="Experimental-Design,-ANOVA-and-ANCOVA_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>What you see above on the left, is a pattern that suggest that the effect of ______ on ________ does not vary by ________. In contrast, on the right the pattern suggests that the effect of ______ on ________ ________ by ________:</p>
</div>
<div id="analyse-the-data" class="section level3 hasAnchor" number="7.2.3">
<h3 class="hasAnchor"><span class="header-section-number">7.2.3</span> Analyse the data<a href="#analyse-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As with the plotting, we now analyse each data set.<br />
We also make a mistake of analysing the data that has an interaction with a model that does not specify this interaction. This mod3 is incorrect, but fitting it helps illuminate why you should fit the interaction if your design contains the potential for an interaction (a factorial design).</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model with no interaction</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>int_mod_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(obs <span class="sc">~</span> CO2<span class="sc">*</span>UVB, <span class="at">data =</span> design)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># model with interaction</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>int_mod_2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(obs2 <span class="sc">~</span> CO2<span class="sc">*</span>UVB, <span class="at">data =</span> design)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co"># model with interaction, but specified incorrectly.</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>int_mod_3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(obs2 <span class="sc">~</span> CO2 <span class="sc">+</span> UVB, <span class="at">data =</span> design)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(int_mod_1)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: obs
##           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## CO2        1 321.00  321.00  33.469 8.671e-05 ***
## UVB        1 241.27  241.27  25.156 0.0003013 ***
## CO2:UVB    1   1.13    1.13   0.118 0.7371854    
## Residuals 12 115.09    9.59                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(int_mod_2)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: obs2
##           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## CO2        1 671.67  671.67 70.0311 2.364e-06 ***
## UVB        1  56.75   56.75  5.9165   0.03159 *  
## CO2:UVB    1  82.15   82.15  8.5654   0.01268 *  
## Residuals 12 115.09    9.59                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(int_mod_3)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: obs2
##           Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## CO2        1 671.67  671.67  44.269 1.58e-05 ***
## UVB        1  56.75   56.75   3.740  0.07519 .  
## Residuals 13 197.24   15.17                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Note the differences in the outputs. Note what we infer if we model the interaction data incorrectly. There is no free lunch. You must understand your data and your question and you must fit the model that correctly matches your design!</p>
</div>
<div id="final-figuring" class="section level3 hasAnchor" number="7.2.4">
<h3 class="hasAnchor"><span class="header-section-number">7.2.4</span> final figuring<a href="#final-figuring" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Don’t forget that the correct standard error for the ‘result’ is the residuals mean squared. You can use the dplyr+ggplot2 method, or visreg.</p>
<p>Here we use visreg and put the figure next to our original ggplot for the interaction data.</p>
<p>We plot the correct model for the interaction data.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">visreg</span>(int_mod_2,<span class="st">&quot;CO2&quot;</span>,<span class="at">by=</span><span class="st">&quot;UVB&quot;</span>,<span class="at">gg=</span><span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>p2<span class="sc">+</span>p3</span></code></pre></div>
<p><img src="Experimental-Design,-ANOVA-and-ANCOVA_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<!--chapter:end:08-Interactions.Rmd-->
</div>
</div>
</div>
<div id="a-summary-experimental-design-and-anova" class="section level1 hasAnchor" number="8">
<h1 class="hasAnchor"><span class="header-section-number">8</span> A Summary: Experimental Design and ANOVA<a href="#a-summary-experimental-design-and-anova" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>There are three sets of things you should now know about based on reading these chapters and working through the examples. The first set is a bunch of clever R stuff for helping generate experimental designs. The second set is a better understanding of experimental designs in general. The third set is how to analyse and interpret data from 1-way and 2-way ANOVA models, that are the toolboxes for analysing these designs.</p>
<p>Lets review these in reverse order</p>
<div id="how-to-analyse-anova-models" class="section level2 hasAnchor" number="8.1">
<h2 class="hasAnchor"><span class="header-section-number">8.1</span> How To Analyse ANOVA models<a href="#how-to-analyse-anova-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In semester 1, you were introduced to the 1-way ANOVA model, using the daphnia parasite data. Here you’ve learned more about those analyses.</p>
<p>You now understand better what treatment contrasts are, the risk of post-hoc tests like the Tukey Test, and methods for making <em>a priori</em> contrasts to test specific hypothesis. You learned how specify specific hypoptheses and use the <code>fit.contrast</code> function from the <em>gmodels</em> package to help you be really precise in asking and answering questions.</p>
<p>You also learned how to include a blocking factor in your models to control for environmental gradients in your experiments. You learned how to estimate the standard error that is used for the testing of among treatment level differences too.</p>
<p>Finally, you learned about the idea of interactions - the effect of UVB on Plant Yield Varies by CO2 level. You learned how to fit these models (e.g. <code>lm(Yield ~ UVB * CO2, data = dataframe)</code>) and how to interpret the statistical outputs against the graphs you made. Speaking of which, you learned how tomake graphs that reveal the presence of interactions, or not.</p>
</div>
<div id="experimental-designs." class="section level2 hasAnchor" number="8.2">
<h2 class="hasAnchor"><span class="header-section-number">8.2</span> Experimental Designs.<a href="#experimental-designs." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You should now understand the differences between, and value of the Completely Randomised Design, the Randomised Complete Block Design and the Latin Square Design. There are plenty more designs out there to manage lots of different issues. The <em>agricolae</em> package is a great tool for generating designs (to help plan experminents) and is also a great resource for learning about them.</p>
<p><a href="https://myaseen208.github.io/agricolae/articles/Intro_agricolae.html" class="uri">https://myaseen208.github.io/agricolae/articles/Intro_agricolae.html</a></p>
</div>
<div id="clever-r-stuff" class="section level2 hasAnchor" number="8.3">
<h2 class="hasAnchor"><span class="header-section-number">8.3</span> Clever R Stuff<a href="#clever-r-stuff" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You’ve also increased your R ninja skills. You’ve learned about building ‘fake data’ using the <code>design_</code> class of functions in <em>agricolae</em> mixed with random numbers and a clear set of tools that develop understanding of how additive and interactive effects arise among treatments in your data. This is a super skill.</p>
<p>There is nothing better than making data that has a pattern or not, to understand better where patterns are in your own data. If you can build ‘fake data’ with and without the pattern you might expect from theory, then you have the template on which to examine carefully your ‘real data’ collected via the experiments or surveys.</p>
<!--chapter:end:09-Summary_ANOVA_Interactions.Rmd-->
</div>
</div>
<div id="introducing-the-ancova---the-analysis-of-covariance" class="section level1 hasAnchor" number="9">
<h1 class="hasAnchor"><span class="header-section-number">9</span> Introducing the ANCOVA - the analysis of covariance<a href="#introducing-the-ancova---the-analysis-of-covariance" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In the previous chapters, we introduced classic experimental design principles, and in doing so, we focused on revisiting the 1-way ANOVA and introduced the 2-way ANOVA. In these models, the explanatory variables are categorical (they are factors). This means explanatory variable has distinct, discrete categories or <em>levels</em>.</p>
<p>In many of our experiments, however, we might combine these categorical variables with a continuous variable. For example, we might estimate eggs produced as a function of body size and season or we might estimate the effect on plant growth rates of soil moisture in high versus low Nitrogen (N) conditions.</p>
<p>These simple examples describe an ANCOVA, where the one explanatory variable is continuous (e.g. body size or soil moisture) and the other is categorical (e.g. season or N-level). When this is the case, we are essentially combining the ANOVA with the Regression. If we recall that regression is largely about estimatinge slopes and intercepts, we might think, hey, COOL, so in an ANCOVA, we can ask if the categorical variable alters the slope or not…..</p>
<p>What’s very important to understand is that our core statement about interactions does not change.</p>
<blockquote>
<p>The effect of X on Y varies by Z, translates to a) The effect of body size on egg production varies by season; or b) the effect of soil moisture on growth rate varies by N-level</p>
</blockquote>
<p>When written like this, the previous statements about slopes should be even more clear. The effect of body size (continuous) on egg production is a regression and we estimate a slope. We then can ask whether this slope is different between seasons.</p>
<div id="setting-up-the-various-ideas." class="section level2 hasAnchor" number="9.1">
<h2 class="hasAnchor"><span class="header-section-number">9.1</span> Setting up the various ideas.<a href="#setting-up-the-various-ideas." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s start by looking at an example where the effect of Height on Weight varies by Sex. This is a classic set of data from numerous organisms…. it captures biologically the question about sexual dimorphism - does the relationship between Height and Weight (a regression) vary by Sex (ANOVA)?</p>
<p>This relationship can take on many patterns.</p>
<p><img src="images/ANCOVA_1.png" width="644" /></p>
<ul>
<li>In the upper left we see a pattern where Males are heavier than Females, but there is no effect of Height on Weight.</li>
<li>In the upper right, we see that there is a positive relationship between Weight and Height, but no differences between Males and Females.</li>
<li>In the lower left, we might argue that there is a positive relationship between Weight and Height, that the relationship between Weight and Height does not vary (the slope is the same) and that Males are heavier (the red dots are mostly above the blue)</li>
<li>In the lower right, we see evidence of an interaction - the effect of Height on Weight (the slopes), varies by Sex.</li>
</ul>
<p>It’s quite important to recognise that each of patterns is possible outcome to testing the SAMEa hypothesis. The key thing to remember is that we have an a priori (in advance hypothesis). Regardless of the pattern, we should specify the appropriate model to test your the hypothesis and answer the question that motivated the design of the experiment and data collection.</p>
<p>For example, in these data, we fundamentally start with the question - does the effect of Height on Weight vary by Sex. The data might look like any of the above patterns. But as we started with that, we have to try and answer that question. And there is only one model syntax in the above figure that does this: <code>Weight ~ Height * Sex</code>. We’ll expand on what this means as we work through the example.</p>
</div>
<div id="working-through-and-example." class="section level2 hasAnchor" number="9.2">
<h2 class="hasAnchor"><span class="header-section-number">9.2</span> Working through and example.<a href="#working-through-and-example." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s work with a built in dataset in R - the Davis Study, which is exactly these data. The associated assignment is another example.</p>
<p>The process of doing this will follow a tried and true approach to analysing data. You should embed this workflow in your head:</p>
<ol style="list-style-type: decimal">
<li>PLOT the Data</li>
<li>Build the model to test the hypothesis</li>
<li>Check the Assumptions</li>
<li>Make Inference</li>
<li>Update the Figure for Publication</li>
</ol>
<div id="get-the-data-and-make-your-picture" class="section level3 hasAnchor" number="9.2.1">
<h3 class="hasAnchor"><span class="header-section-number">9.2.1</span> Get the data and make your picture<a href="#get-the-data-and-make-your-picture" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The data are built into R, but embedded in the <code>carData</code> package, which was installed with the <code>car</code> package.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>Davis <span class="ot">&lt;-</span> carData<span class="sc">::</span>Davis</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(Davis)</span></code></pre></div>
<pre><code>## Rows: 200
## Columns: 5
## $ sex    &lt;fct&gt; M, F, F, M, F, M, M, M, M, M, M, F, F, F, F, F, M, F, M, F, M, …
## $ weight &lt;int&gt; 77, 58, 53, 68, 59, 76, 76, 69, 71, 65, 70, 166, 51, 64, 52, 65…
## $ height &lt;int&gt; 182, 161, 161, 177, 157, 170, 167, 186, 178, 171, 175, 57, 161,…
## $ repwt  &lt;int&gt; 77, 51, 54, 70, 59, 76, 77, 73, 71, 64, 75, 56, 52, 64, 57, 66,…
## $ repht  &lt;int&gt; 180, 159, 158, 175, 155, 165, 165, 180, 175, 170, 174, 163, 158…</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Davis, <span class="fu">aes</span>(<span class="at">x =</span> height, <span class="at">y =</span> weight, <span class="at">col =</span> sex))<span class="sc">+</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="Experimental-Design,-ANOVA-and-ANCOVA_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>Ahh…. first hurdle…. what’s going on here? Well, always plot your data is totally justified, because it looks like one of the data points has the Height and Weight data entered incorrectly.</p>
<p>Let’s fix that. Lets find the row, and make the change</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">#which row? 12</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>Davis <span class="sc">%&gt;%</span> <span class="fu">filter</span>(height <span class="sc">&lt;</span> <span class="dv">100</span>)</span></code></pre></div>
<pre><code>##    sex weight height repwt repht
## 12   F    166     57    56   163</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># BASE R syntax to see each observation</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>Davis<span class="sc">$</span>weight[<span class="dv">12</span>]</span></code></pre></div>
<pre><code>## [1] 166</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>Davis<span class="sc">$</span>height[<span class="dv">12</span>]</span></code></pre></div>
<pre><code>## [1] 57</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># BASE R syntax to change them</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>Davis<span class="sc">$</span>weight[<span class="dv">12</span>] <span class="ot">&lt;-</span> <span class="dv">57</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>Davis<span class="sc">$</span>height[<span class="dv">12</span>] <span class="ot">&lt;-</span> <span class="dv">166</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co"># replot</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Davis, <span class="fu">aes</span>(<span class="at">x =</span> height, <span class="at">y =</span> weight, <span class="at">col =</span> sex))<span class="sc">+</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="Experimental-Design,-ANOVA-and-ANCOVA_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p>Excellent. Lets look at this picture and ask ourselves whether the effect of Height on Weight appears to vary by Sex? What do you think?</p>
<p>We can actually get a bit of help here. We can use some ggplot magic to help us make this GUESS.
&gt; NOTE: this is not doing statistics. This is using graphics to help guide our expectation of the outcome of doing the statistical test of our hypothesis.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Davis, <span class="fu">aes</span>(<span class="at">x =</span> height, <span class="at">y =</span> weight, <span class="at">col =</span> sex))<span class="sc">+</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add a best fit line to each group (the sex category)</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="Experimental-Design,-ANOVA-and-ANCOVA_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<p>Again, we have not ‘proven’ anything or tested our hypothesis. What we have is a good guess though. We can guess that</p>
<ol style="list-style-type: decimal">
<li>Males are heavier than females (what is the difference in the intercepts?)</li>
<li>The effect of height on weight is positive (the slope(s) are positive, not negative)</li>
<li>There might be a difference in slopes - the Male line is steeper.</li>
</ol>
<p>We might even go as far to estimate by eye the slope assuming that there is no effect of Sex. Recalling that the slope is the rise/run or the change in y over the change in x, we can guess that the slope is ~ (100-40)/(200-140) = (60/60) = 1. We are not expecting much variation around that. But if we see the statistics returning a value 10x more or less than this, we should be concerned!</p>
</div>
</div>
<div id="building-the-model-and-understanding-it" class="section level2 hasAnchor" number="9.3">
<h2 class="hasAnchor"><span class="header-section-number">9.3</span> Building the model (and understanding it)<a href="#building-the-model-and-understanding-it" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The next step is to build the model to test our hypothesis. As we declared above, the model to test the interaction is <code>lm(weight ~ height * sex, data = Davis)</code>. Let’s discuss this a bit.</p>
<p>First, this model expands to the following full description:</p>
<p><code>lm(weight ~ height + sex + height:sex, data = Davis)</code></p>
<p>This reads as “Weight is a function of the effect of Height (slope), Sex (intercept) and the interaction between Height and Sex (do the slopes vary?). The <code>Height * Sex</code> syntax always expands to this <em>full model</em> - the model containing the main effects and the interaction.</p>
<p>OK. Let’s fit the model</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we call the model mod_Davis.</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>mod_Davis <span class="ot">&lt;-</span> <span class="fu">lm</span>(weight <span class="sc">~</span> height <span class="sc">+</span> sex <span class="sc">+</span> height<span class="sc">:</span>sex, <span class="at">data =</span> Davis)</span></code></pre></div>
<p>That’s it. We’ve got the model. But before we make any attempts at actually evaluating our test of the hypothesis, we have to check the assumptions!</p>
<p>To do this, we use the autplot function from the ggfortify package.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(mod_Davis)</span></code></pre></div>
<p><img src="Experimental-Design,-ANOVA-and-ANCOVA_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<p>OK. Let’s walk through the three core diagnostics.</p>
<p>In the upper left, we are evaluating the systematic part of the model - are there any systematic departures from the linear model we’ve speficied? Are there interactions missing or specific nonlinearities? Nope.</p>
<p>In the upper right, we are evaluating the normality of the residuals. These too look pretty good.</p>
<p>In the lower left, we are evalauting the assumption of a constant mean-variance relationship. Oops.</p>
<div id="dealing-with-some-issues-with-residuals." class="section level3 hasAnchor" number="9.3.1">
<h3 class="hasAnchor"><span class="header-section-number">9.3.1</span> Dealing with some issues with residuals.<a href="#dealing-with-some-issues-with-residuals." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The above issue is one we can deal with via a <em>transformation</em>. Let’s start with the facts…. When the variance increases with the mean, one transformation that can work is the logarithm of the continuous variables.</p>
<p>ADD DYLANS STUFF FROM MEE PAPERS and Mean - VARIANCE</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># re-plot with log-log</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Davis, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(height), <span class="at">y =</span> <span class="fu">log</span>(weight), <span class="at">col =</span> sex))<span class="sc">+</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="Experimental-Design,-ANOVA-and-ANCOVA_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the model - note we can specify the transformation RIGHT IN THE MODEL</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>mod_Davis_log <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(weight) <span class="sc">~</span> <span class="fu">log</span>(height) <span class="sc">*</span> sex, <span class="at">data =</span> Davis)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co"># check the new residuals</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(mod_Davis_log)</span></code></pre></div>
<p><img src="Experimental-Design,-ANOVA-and-ANCOVA_files/figure-html/unnamed-chunk-45-2.png" width="672" /></p>
<p>This is definitely flatter - you can tell by the range on the y-axis of the scale-location plot.</p>
<p>So, we can now move to evaluating the model. You are probably thinking about what it means to analyse the data on the log-log axis…. we will come to that shortly.</p>
</div>
<div id="making-inference-on-the-ancova" class="section level3 hasAnchor" number="9.3.2">
<h3 class="hasAnchor"><span class="header-section-number">9.3.2</span> Making inference on the ANCOVA<a href="#making-inference-on-the-ancova" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>OK. So, the next step is to use review the ANOVA table - yes, we use the same Anova function to build an anova table to explore the results of an ANCOVA.</p>
<p>Let’s revisit our initial guesses and work through what the model is telling us:</p>
<ol style="list-style-type: decimal">
<li>Males are heavier than females (what is the difference in the intercepts?)</li>
<li>The effect of height on weight is positive (the slope(s) are positive, not negative)</li>
<li>There might be a difference in slopes - the Male line is steeper.
`</li>
</ol>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod_Davis_log)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: log(weight)
##                  Df Sum Sq Mean Sq  F value    Pr(&gt;F)    
## log(height)       1 4.6643  4.6643 357.4735 &lt; 2.2e-16 ***
## sex               1 0.3446  0.3446  26.4115 6.647e-07 ***
## log(height):sex   1 0.0144  0.0144   1.1038    0.2947    
## Residuals       196 2.5574  0.0130                       
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The table tells us that there is no evidence for an interaction. The last line of this table contains the p-value for the interaction. It is testing the null hypothesis that the slopes are the same. We can not reject this null hypothesis. There is no evidence that allowing the slopes for Males and Females be different is supported. That’s the answer to guess 3 above. It is also the answer to our question: does the effect of Height on Weight vary by Sex. Nope.</p>
<p>However, we do detect <em>main effects</em> of height and sex. This means that each of these DOES have an effect - but we say the effects are additive.</p>
<p>Great. What this means is that the data actually conform to picture in the lower left.</p>
<p><img src="images/ANCOVA_1.png" width="644" /></p>
<p>There is a slope associated with Height (we don’t know whether it’s positive or not, but we think it is), and there is an effect of sex (we don’t know whether Males are heavier yet). What we can say, with confidence, is this.</p>
<blockquote>
<p>The effect of height on weight did not vary by sex (F = 1.01, df = 1,196, p = 0.29). The effect of sex (F, df, p) and height (F, df, p) are thus additive on Weight.</p>
</blockquote>
<p>Another way to read this is the following:</p>
<p>When we allow for a common slope associated with logHeight, we capture 4.66 units of variation in weight, which when compared to the 0.013 units of variation left over (residual MSE), is alot. The F is thus BIG and the p-value small. When we allow for an effect of Sex to define different average weights, this too is important as it captures 0.344 units of variation in weight, which comparied to the 0.013 units in the residual, is also big (Big F, small P). However, when we allow for the slopes caused by height to vary with sex, this captures very little variation with respect to the residual variation (0.014 comprared to 0.013) hence a small F and a large P.</p>
</div>
<div id="the-summary-table-and-making-sense-of-the-log-stuff." class="section level3 hasAnchor" number="9.3.3">
<h3 class="hasAnchor"><span class="header-section-number">9.3.3</span> The summary table and making sense of the log stuff.<a href="#the-summary-table-and-making-sense-of-the-log-stuff." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s start investigating the actual details via the <code>summary</code> table:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_Davis_log)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = log(weight) ~ log(height) * sex, data = Davis)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.29310 -0.06543 -0.00592  0.07420  0.43410 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)       -5.3202     1.6016  -3.322  0.00107 ** 
## log(height)        1.8329     0.3138   5.841 2.13e-08 ***
## sexM              -2.3724     2.3765  -0.998  0.31936    
## log(height):sexM   0.4852     0.4618   1.051  0.29473    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1142 on 196 degrees of freedom
## Multiple R-squared:  0.6626, Adjusted R-squared:  0.6575 
## F-statistic: 128.3 on 3 and 196 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>This table reports on the <em>treatment contrasts</em> we introduced earlier this semester. Let’s walk through the details.</p>
<p>The first two rows correspond to one of the sexes. Can you identify which one? The hint is looking at the other rows. They have an M after them. M comes after F. So the first two rows correspond to the intercept and slope of the Females.</p>
<p>You may be asking why the intercept is a negative number. A simple look back at the range of the x-axis should answer this… the y intercept occurs at x = 0, right?</p>
<p>You should understand, from the principles of an equation for a line, the following:</p>
<blockquote>
<p>the effect of height on weight for females is <code>log(weightF) = -5.31 + 1.82*log(heightF)</code>.</p>
</blockquote>
<p>OK… let’s interpret what the next two lines mean. The third line is labelled <code>SexM.</code> The fourth is labelled <code>logHeight:SexM</code>. Any guesses as to which is associated with the slope and which the intercept?</p>
<p>One trick, again, is to recognise the syntax -&gt; the presence of the <code>:</code> is indicative of the interaction which is the thing that lets slopes vary. So, <code>SexM</code> is about intercepts and <code>logHeight:SexM</code> is about slopes. But what are they?</p>
<p>Please recall from previous work that treatment contrasts are about DIFFERENCES. Thus, the <code>sexM</code> term is a difference between the female and make intercept and the <code>logHeight:SexM</code> is about the difference between the female and make slopes.</p>
<p>This allows the following maths….</p>
<p><code>log(weightF) = -5.31 + 1.82*log(heightF)</code></p>
<p><code>log(weightM) = (-5.31-2.37) + (1.82+0.48)*(log(heightF))</code></p>
<p>However, we know that the 0.48 increase in the slope is not siginficant, and as a result, the -2.37 increase in the intercept is also not correct.</p>
</div>
<div id="the-equations-supported-by-the-model." class="section level3 hasAnchor" number="9.3.4">
<h3 class="hasAnchor"><span class="header-section-number">9.3.4</span> The equations supported by the model.<a href="#the-equations-supported-by-the-model." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In order to identify the equations supported by the model, we can refit the model to reflect the ADDITIVE effects only.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>mod_Davis_log2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(weight) <span class="sc">~</span> <span class="fu">log</span>(height) <span class="sc">+</span> sex, <span class="at">data =</span> Davis)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_Davis_log2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = log(weight) ~ log(height) + sex, data = Davis)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.28714 -0.06906 -0.00978  0.07615  0.43717 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -6.46349    1.17541  -5.499 1.18e-07 ***
## log(height)  2.05688    0.23030   8.931 2.99e-16 ***
## sexM         0.12417    0.02417   5.138 6.66e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1143 on 197 degrees of freedom
## Multiple R-squared:  0.6607, Adjusted R-squared:  0.6573 
## F-statistic: 191.8 on 2 and 197 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Right, now we get our expected pattern:</p>
<p><code>log(weightF) = -6.46 + 2.05*log(heightF)</code></p>
<p><code>log(weightM) = (-6.46 + 0.12) + 2.05*log(heightF)</code></p>
<p>We can see the common slope and the slightly higher average weight (0.12 units!) of males.</p>
</div>
<div id="making-even-more-inference-and-drawing-the-picture" class="section level3 hasAnchor" number="9.3.5">
<h3 class="hasAnchor"><span class="header-section-number">9.3.5</span> Making even more inference and drawing the picture<a href="#making-even-more-inference-and-drawing-the-picture" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>OK, lets use some plotting tricks and get a nice picture:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first create a data frame to use that combines the raw data </span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with the predictions from the model</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co"># note that the model is the ADDITIVE model, for plotting</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>plotThis <span class="ot">&lt;-</span> Davis <span class="sc">%&gt;%</span> </span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">preds =</span> <span class="fu">predict</span>(mod_Davis_log2))</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="co"># now, make lines with the model predictions</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="co"># and add the points as the raw data</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="co"># pay attention to where we are using log()!</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plotThis, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(height), <span class="at">y =</span> preds, <span class="at">col =</span> sex))<span class="sc">+</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">log</span>(weight)))</span></code></pre></div>
<p><img src="Experimental-Design,-ANOVA-and-ANCOVA_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<p>Great. Now we can see that the full model (mod_Davis_log) told us. The lines are parallel. There is no interaction.</p>
<p>In fact, we can do a bit more here.</p>
<p>Remember that the model says</p>
<p>For women log(weight)= -6.46 + 2.05 * log(height)
For men log(weight)= (-6.46 + 0.12) + 2.05 * log(height)</p>
<p>Because we are in log land, we can do some clever maths: We know that</p>
<p><code>log(weight Female) - log(weight Male) = - 0.12</code></p>
<p>(this is the treatment contrast for the intercept). We also know (please memorise) that the difference between logs is equal to the log of the ratio:</p>
<p><code>log(weightF/weightM) = -0.12</code></p>
<p>Finally, we can convert both sides to non-log by exponentiating:</p>
<p><code>exp(log(weightF/weightM)) = exp(-0.12) = 0.88</code></p>
<p>What does this mean? At any given height, female weight is 88% of a makes (12% lower).</p>
<p>Cool! That’s one of the benefits of log-log linear relationships. The ratio of the categories in log-log land directly translates to a percent difference between the groups.</p>
<p>It’s also worth noting that the height slope is ~2, which suggests… yes… because we are in log-land, that weight scales with <span class="math inline">\(height^2\)</span>.</p>
<p>One way to ‘test’ this is to ask whether estimating the log(weight) slope improve the fit of the model compared to fixing it at 2. Here are ways: ‘by hand’ and by a function in the <code>car</code> package.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># by hand</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="co"># we use the offset function to fix the slope of height at 2</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>mod_Davis_offset <span class="ot">&lt;-</span><span class="fu">lm</span>(<span class="fu">log</span>(weight) <span class="sc">~</span>  sex <span class="sc">+</span> <span class="fu">offset</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">log</span>(height)), <span class="at">data=</span>Davis)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="co"># then compare it to the model where we estimate it freely.</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod_Davis_log2, mod_Davis_offset)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: log(weight) ~ log(height) + sex
## Model 2: log(weight) ~ sex + offset(2 * log(height))
##   Res.Df    RSS Df  Sum of Sq     F Pr(&gt;F)
## 1    197 2.5718                           
## 2    198 2.5726 -1 -0.0007962 0.061 0.8052</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># by car package</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">linearHypothesis</span>(mod_Davis_log2, <span class="st">&quot;log(height) = 2&quot;</span>) <span class="co"># the estimate IS 2</span></span></code></pre></div>
<pre><code>## Linear hypothesis test
## 
## Hypothesis:
## log(height) = 2
## 
## Model 1: restricted model
## Model 2: log(weight) ~ log(height) + sex
## 
##   Res.Df    RSS Df Sum of Sq     F Pr(&gt;F)
## 1    198 2.5726                          
## 2    197 2.5718  1 0.0007962 0.061 0.8052</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">linearHypothesis</span>(mod_Davis_log2, <span class="st">&quot;log(height) = 0&quot;</span>) <span class="co"># the estimate IS NOT 0.</span></span></code></pre></div>
<pre><code>## Linear hypothesis test
## 
## Hypothesis:
## log(height) = 0
## 
## Model 1: restricted model
## Model 2: log(weight) ~ log(height) + sex
## 
##   Res.Df    RSS Df Sum of Sq      F   Pr(&gt;F)    
## 1    198 3.6131                                 
## 2    197 2.5718  1    1.0413 79.768 2.99e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
</div>
<div id="some-general-principles" class="section level2 hasAnchor" number="9.4">
<h2 class="hasAnchor"><span class="header-section-number">9.4</span> Some General Principles<a href="#some-general-principles" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="ancova-always-tests-the-interaction-against-the-additive-model" class="section level3 hasAnchor" number="9.4.1">
<h3 class="hasAnchor"><span class="header-section-number">9.4.1</span> ANCOVA always tests the interaction against the additive model<a href="#ancova-always-tests-the-interaction-against-the-additive-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This figure highlights the various models and interpretations associated with the pieces of an ANCOVA dataset. This is a way to envision all of the potential linear relationships among the variables that might arise in an experiment with a continuous and categorical explanatory variable.</p>
<p>Note that just because your data looks like a particular pattern doesn’t mean you should use that model. Your statistical model should be driven by your question and original design.</p>
<div class="figure">
<img src="images/GSwithR_Grid.png" alt="From Getting Started with R, 2nd Edition, OUP" width="740" />
<p class="caption">
(#fig:unnamed-chunk-52)From Getting Started with R, 2nd Edition, OUP
</p>
</div>
<p>For example, if you design a study with an ANCOVA question in mind, you are always starting your analysis with the question of whether the effect of X on Y varies by Z. Thus, ANCOVA always starts with comparing the interaction (model E) against the additive model (model D).</p>
<blockquote>
<p>Proof: If we compare the additive model and the model with the interaction, we are specifically testing for whether allowing the slopes to vary by sex <em>explains additional variation</em> above and beyond the main, additive effects of height and sex. To do this, we use <code>anova()</code> but pass it two models. This does what is called a Liklihood Ratio Test.
Compare the result of the first test to the last line of the second. This proves that when we fit model E, the test for the interaction is a comparison with model D!</p>
</blockquote>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod_Davis_log, mod_Davis_log2)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: log(weight) ~ log(height) * sex
## Model 2: log(weight) ~ log(height) + sex
##   Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)
## 1    196 2.5574                           
## 2    197 2.5718 -1 -0.014402 1.1038 0.2947</code></pre>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Anova</span>(mod_Davis_log)</span></code></pre></div>
<pre><code>## Anova Table (Type II tests)
## 
## Response: log(weight)
##                  Sum Sq  Df F value    Pr(&gt;F)    
## log(height)     1.04135   1 79.8099 3.024e-16 ***
## sex             0.34461   1 26.4115 6.647e-07 ***
## log(height):sex 0.01440   1  1.1038    0.2947    
## Residuals       2.55738 196                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<div id="specifying-models-in-r" class="section level3 hasAnchor" number="9.4.2">
<h3 class="hasAnchor"><span class="header-section-number">9.4.2</span> Specifying models in R<a href="#specifying-models-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can add terms
<code>weight ~ sex + height</code></p>
<p>Have crossed terms
<code>weight ~ sex * height</code> which is <code>weight ~ sex +  height + sex : height</code></p>
<p>Remove terms
<code>weight ~ sex * height – sex : height</code> which is <code>weight~ sex +  height</code></p>
<p>Include all interactions up to order k
<code>weight~ (sex + height + age)^2</code> which is <code>sex + height + age + sex : height + sex : age + age : height</code></p>
<!--chapter:end:10-Introducing_ANCOVA.Rmd-->
</div>
</div>
</div>
<div id="introduction-1" class="section level1 hasAnchor" number="10">
<h1 class="hasAnchor"><span class="header-section-number">10</span> Introduction<a href="#introduction-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Welcome to An Introduction to Experimental Design ANOVA and ANCOVA</p>
<p>In this mini-module, you’ll be learning about the principles of experimental design and analysis of a few classic designes, the 2x2 ANOVA and ANCOVA experiments.</p>
<p>This module is compulsory for all, because it forms the foundation for most of the more complex experiments you will do as a researcher. And it is the major step beyond the t-test, 1-way ANOVA, simple regression and chi-square contingency table analyses we’ve covered thus far.</p>
<p>The learning outcome for this mini-module are that you will understand the basic ideas about</p>
<ul>
<li>Replication, Randomisation and Reducing Noise</li>
<li>Precision, Bias and Systematic Error</li>
<li>The Completely Randomised Design</li>
<li>The Randomised Block Design</li>
<li>The 2-way ANOVA</li>
<li>The ANCOVA Design</li>
</ul>
<p>In order to be successful with this final section of the course, you need to feel comfortable with the 1-way ANOVA and the Regression model. Please review these concepts. You can also refer to Chapter 5 and 6 in Getting Started with R (available as an online Resource via STARPlus) which covers a great deal of the mechanics of using R to do these types of models. Finally, you will also need to feel comfortable with dplyr and ggplot - we’ll be reinforcing the old stuff and introducing a few new tricks.</p>
<div id="the-three-rs-the-foundation-of-experimental-design.-1" class="section level2 hasAnchor" number="10.1">
<h2 class="hasAnchor"><span class="header-section-number">10.1</span> The Three Rs: The Foundation of Experimental Design.<a href="#the-three-rs-the-foundation-of-experimental-design.-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Before we get started, it’s vital that you understand that there are some very basic principles needed to ensure that your experiments can provide robust and reliable inference (answers to your questions). The “3 R’s”.</p>
<ul>
<li><strong>Randomisation</strong>: the random allocation of treatments to the experimental units, to avoid confounding between treatment effects and other unknown effects.</li>
<li><strong>Replication</strong>: the repetition of a treatment within an experiment, to quantify the natural variation between experimental units and increase accuracy of estimated effects.</li>
<li><strong>Reduce noise:</strong> by controlling as much as possible the conditions in the experiment, e.g. by grouping of similar experimental units in blocks.</li>
</ul>
<p>As we develop our understanding of experimental design, you should come back to these core definitions and see if your understanding of them has improved. We work on these concepts in the next chapter of the book.</p>
</div>
<div id="the-general-linear-model-1" class="section level2 hasAnchor" number="10.2">
<h2 class="hasAnchor"><span class="header-section-number">10.2</span> The General Linear Model<a href="#the-general-linear-model-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section of the course is focused on a class of model called the General Linear Model. It is not a <strong>GLM</strong>. The <strong>GLM</strong> is a generalised linear model. I know, right?</p>
<p>The general linear model is, as we learned in the past few weeks, a model fit in R with the <code>lm()</code> function. It includes regression, ANOVA, ANCOVA and variations of these.</p>
<p>There are a few key characterstics to remember about these models. The general linear model has the following form:</p>
<p><span class="math inline">\(y = \beta_{0}+\beta_{1}*X_{1}+\beta_{2}*X_{2}+\epsilon\)</span></p>
<p>Where the <span class="math inline">\(y\)</span> is the response variable, the <span class="math inline">\(\beta\)</span>’s are estimated parameters, the <span class="math inline">\(X\)</span>’s are the predictor variables and the <span class="math inline">\(\epsilon\)</span> comes from a Gaussian distribution with zero mean and constant variance.</p>
<p>Let’s decompose that a bit more.</p>
<p>There are two types of predictor variable:</p>
<p><em>Metric</em> predictor variables are measurements of some quantity that may help to predict the value of the response. For example, if the response is the blood pressure of patients in a clinical trial, then age, fat mass and height are potential metric predictor variables. You may know these as <strong>continuous explanatory (independent) variables</strong></p>
<p><em>Factor</em> variables are labels that serve to categorize the response measurements into groups, which may have different expected values. Continuing the blood pressure example, factor variables might be sex and drug treatment received (drug A, drug B or placebo, for example). You may also know these as <strong>categorical explanatory (independent) variables</strong>.</p>
<p>So, you hopefully can see how this <em>general</em> linear model is capable of representing</p>
<ol style="list-style-type: decimal">
<li><em>ANOVA</em> – Analysis of variance -&gt; Predictors are factors.</li>
<li><em>Regression</em> -&gt; Predictor is a metric variable (continuous variable).<br />
</li>
<li><em>Multiple regression</em> -&gt; Predictors are metric variables (continuous variables).</li>
<li><em>ANCOVA</em> - Analysis of co-variance -&gt; Predictors are a mixture of metric variables (continuous variables) and factors.</li>
</ol>
<p>Finally, it is important to understand that non-linear relationships such as these data below can be modelled with a linear model:</p>
<p><img src="Experimental-Design,-ANOVA-and-ANCOVA_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>
<p>How, you ask!? Well…. consider this equation:</p>
<p><span class="math inline">\(y = 0.01 + x + x^{2} + \epsilon\)</span></p>
<p>Referring to our generic model structure above,</p>
<p><span class="math inline">\(y = \beta_{0}+\beta_{1}*X_{1}+\beta_{2}*X_{2}+\epsilon\)</span></p>
<p>we hopefully can see that <span class="math inline">\(\beta_{0} = 0.01\)</span>, <span class="math inline">\(\beta_{1} = 0\)</span> and <span class="math inline">\(\beta_{2} = 1\)</span>, where <span class="math inline">\(X_{2} = X^{2}\)</span>!</p>
<p>Linear models are perfectly capable of being used to estimate non-linear relationships!</p>
<p>Here is the code to make that figure.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set x range</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">100</span><span class="sc">:</span><span class="dv">100</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="co"># define y without error</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>y_det <span class="ot">&lt;-</span> <span class="fl">0.01</span><span class="sc">+</span>x<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="co"># add some random variation</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> y_det<span class="sc">+</span><span class="fu">rnorm</span>(<span class="fu">length</span>(x),<span class="dv">0</span>,<span class="dv">1000</span>)</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataframe and plot</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x, y)</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y))<span class="sc">+</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
</div>
</div>
<div id="readings---1" class="section level1 hasAnchor" number="11">
<h1 class="hasAnchor"><span class="header-section-number">11</span> Readings —-<a href="#readings---1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>There are several resources that will help with this section of the stats course, and onwards</p>
<ul>
<li>Getting Started with R - An Introducton for Biologists, Second Edition (available as an electronic online resource via StarPlus). Specifically Chapter 5 and 6.</li>
<li>Experimental Design for the Life Sciences - Nick Colegrave and Graham Ruxton (seen on eBay for £2.50!)</li>
<li>Of course, the venerable coursebook for APS 240: <a href="https://dzchilds.github.io/stats-for-bio/index.html" class="uri">https://dzchilds.github.io/stats-for-bio/index.html</a></li>
</ul>
<div id="install-some-extra-packages---1" class="section level2 hasAnchor" number="11.1">
<h2 class="hasAnchor"><span class="header-section-number">11.1</span> Install some extra packages —-<a href="#install-some-extra-packages---1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In order to make this module more effective, we are going to use some additional resources from CRAN.</p>
<p>Please install these packages, if you have not already, using the install packages tab in RStudio:</p>
<ul>
<li><code>tidyverse</code></li>
<li><code>ggfortify</code></li>
<li><code>agricolae</code></li>
<li><code>car</code></li>
<li><code>gmodels</code></li>
<li><code>visreg</code></li>
<li><code>patchwork</code></li>
</ul>
<!--chapter:end:index.Rmd-->
</div>
</div>
<div id="intro" class="section level1 hasAnchor" number="12">
<h1 class="hasAnchor"><span class="header-section-number">12</span> Introduction To Experimental Design<a href="#intro" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Experiments help us answer questions, but there are also non-experimental techniques. What is so special about experiments?</p>
<p>One of the central features of an experiment is the <em>treatment</em> - a manipulation of some variable of interest that should have an effect on the response variable we are investigating. Whether you are manipulating the levels of a hormone to explore it’s impact on a cell/organ or embryo development, the concentration of a drug to explore it’s efficancy in treating a disease or the levels of nitrogen in soil to explore the impacts on plant growth, a treatment is a deliberate manipulation.</p>
<p>It is also important to remember that there can be <em>natural</em> treatments - there may be natural variation among cells, organisms or gradients in the environment that you can use to represent treatments.</p>
<p>So, to be very clear:</p>
<ol style="list-style-type: decimal">
<li>Experiments allow us to set up a direct comparison among the <em>levels</em> or <em>values</em> of <em>treatments</em> of interest.</li>
<li>We can design experiments to minimize any bias in the comparison.</li>
<li>We can design experiments so that the error in the comparison is small.</li>
<li>We design experiments to be in control, and having that control allows us to make stronger inferences about the nature of differences that we see in the response variable.</li>
</ol>
<blockquote>
<p>Experiments allow us to move towards making inferences about causation.</p>
</blockquote>
<p>This last point distinguishes an experiment from an observational study. In an observational study we merely observe which units are in which treatment groups; we don’t get to <em>control that assignment</em>. This underpins the classic issue with assigning <em>causation to correlation</em> - in the following two examples, there is a strong association between the variables, but there has been no control/manipulation.</p>
<p><img src="images/IceCream_Shark.png" width="268" /><img src="images/Autism_Organic.png" width="320" /></p>
<div id="conepts-associated-with-causation-1" class="section level2 hasAnchor" number="12.1">
<h2 class="hasAnchor"><span class="header-section-number">12.1</span> Conepts associated with causation<a href="#conepts-associated-with-causation-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Mosteller and Tukey (1977) list three concepts associated with causation and state that at least two (preferably all three) are needed to support a causal relationship:</p>
<ul>
<li><em>Consistency</em> – make a change and the response is in the same direction or the amount of response is <em>consistent</em> across populations</li>
<li><em>Responsiveness</em> – make a change and the response changes according to theory</li>
<li><em>Mechanism</em> – make a change and we can monitor/identify a mechanism leading from cause to effect</li>
</ul>
<p>Let’s look at a classic example. Smoking and lung cancer – from 1922 to 1947 annual deaths for lung cancer went from 612 to 9287 (Observation). This was thought in the 1950s to be either an effect of smoking tobacco or atmospheric pollution (Hypothesis). Numerous studies showed that lung cancer was more prevalent in smokers (Observation: <em>consistency</em>). Chemical analyses of tobacco showed it contained carcinogens (Association: <em>mechanism</em>). Public health programs resulted in a reduction in smoking and lung cancer rates decreased (Intervention: <em>responsiveness</em>).</p>
<p>Note the initial study was an observational study and in this case it was not ethical to do the experiment per se!</p>
</div>
<div id="components-of-an-experiment-1" class="section level2 hasAnchor" number="12.2">
<h2 class="hasAnchor"><span class="header-section-number">12.2</span> Components of an Experiment<a href="#components-of-an-experiment-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>An experiment has <em>treatments, experimental units, responses, and a method to assign treatments to units</em>. These four things specify the experimental design.</p>
<p>Not all experimental designs are created equal. A good experimental design must adhere to the 3Rs. It should reveal consistency, responsiveness and mechanism. The way this happens is by avoiding systematic error in measuring things, and allow estimation of error in measurements with precision.</p>
<p>In short, a good experimental design must:</p>
<ul>
<li>Avoid systematic error</li>
<li>Allow estimation of error</li>
<li>Be precise</li>
<li>Have broad validity.</li>
</ul>
<p>Lets walk through some definitions.</p>
<p>If our experiment has <em>systematic error</em>, then our comparisons will be biased, no matter how precise our measurements are or how many experimental units we use. <strong>Randomisation</strong> is our tool to combat <em>systematic error</em>.</p>
<p>Even without <em>systematic error</em>, there will be random error in the responses - this is what we call variation in what we are measuring or more formally variance. Such variation in responses invariably leads to random error in the treatment comparisons. When we compared two means in the t-test, we had to deal with the variation in both groups!</p>
<p>Experiments are precise when this random error in the treatment comparisons is small. Precision depends on the size of the random errors in the responses, the number of units used (<strong>replication</strong>), and the experimental design used.</p>
<p>Experiments must be designed so that we have an estimate of the size of random error. This permits statistical inference: for example, confidence intervals (which arise from standard errors) or tests of significance based on t- or F-statistics.</p>
<p>We cannot do inference without an estimate of this variation. We would like our conclusions to be valid for a wide population, so we need to <em>randomise</em> our subjects or objects we are measuring - for example, we may need to be aware of both sexes and of young and old individuals. But there are always compromises - for example, broadening the scope of validity by using a variety of experimental units may decrease the precision of the responses.</p>
</div>
<div id="how-do-we-increase-precision-and-reduce-bias-1" class="section level2 hasAnchor" number="12.3">
<h2 class="hasAnchor"><span class="header-section-number">12.3</span> How do we increase precision and reduce bias?<a href="#how-do-we-increase-precision-and-reduce-bias-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are several key concepts</p>
<div id="blinding-1" class="section level3 hasAnchor" number="12.3.1">
<h3 class="hasAnchor"><span class="header-section-number">12.3.1</span> Blinding<a href="#blinding-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>Blinding</em> occurs when the evaluators of a response do not know which treatment was given to which unit. Blinding helps prevent bias in the evaluation, even unconscious bias from well-intentioned evaluators. Double blinding occurs when both the evaluators of the response and the (human subject) experimental units do not know the assignment of treatments to units. Blinding the subjects can also prevent bias, because subject responses can change when subjects have expectations for certain treatments.</p>
</div>
<div id="placebos-1" class="section level3 hasAnchor" number="12.3.2">
<h3 class="hasAnchor"><span class="header-section-number">12.3.2</span> Placebos<a href="#placebos-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>Placebo</em> is a null treatment that is used when the <em>act</em> of applying a treatment— any treatment — has an effect. Placebos are often used with human subjects, because people often respond to the process of receiving any treatment: for example,
reduction in headache pain when given a sugar pill. Blinding is important when placebos are used with human subjects. Placebos are also useful for nonhuman subjects. The apparatus for spraying a field with a pesticide may compact the soil. Thus we drive the apparatus over the field, without actually spraying, as a placebo treatment.</p>
</div>
<div id="confounders-1" class="section level3 hasAnchor" number="12.3.3">
<h3 class="hasAnchor"><span class="header-section-number">12.3.3</span> Confounders<a href="#confounders-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>Confounding</em> occurs when the effect of one factor or treatment cannot be distinguished from that of another factor or treatment. The two factors or treatments are said to be confounded. Except in very special circumstances, confounding should be avoided. Consider the following example. We plant corn variety A in Yorkshire and corn variety B in Lancashire. In this experiment, we cannot distinguish location effects (Yorkshire vs. Lancashire) from variety effects (cornA vs. cornB) — the variety factor and the location factor are confounded.</p>
<p>This is despite the fact that we know that Yorkshire will be better…. (that’s a joke)</p>
</div>
</div>
<div id="experimental-vs.-measurement-units-1" class="section level2 hasAnchor" number="12.4">
<h2 class="hasAnchor"><span class="header-section-number">12.4</span> Experimental vs. Measurement units<a href="#experimental-vs.-measurement-units-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A common source of difficulty in designing experiments is the distinction between experimental units and measurement units. We need to know the experimental units, as this is the key value used to generate our inference.</p>
<p>Consider an educational study, with six classrooms of 25 pupils. Each classroom of students is then assigned, at random, to one of two different reading programmes.</p>
<p>At the end of a six-week term, all the students are evaluated via a common reading exam.</p>
<div id="the-challenge-question-1" class="section level3 hasAnchor" number="12.4.1">
<h3 class="hasAnchor"><span class="header-section-number">12.4.1</span> The challenge question<a href="#the-challenge-question-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Are there six experimental units (the classrooms) or 150 (25*6; the students)? We measured the reading ability of the students… but they were in classroom sets of 25….</p>
</blockquote>
</div>
<div id="identifying-the-experimental-unit---an-example-of-pseudo-replication-1" class="section level3 hasAnchor" number="12.4.2">
<h3 class="hasAnchor"><span class="header-section-number">12.4.2</span> Identifying the experimental unit - an example of <strong>pseudo-replication</strong><a href="#identifying-the-experimental-unit---an-example-of-pseudo-replication-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To identify the experimental units the key question is: To which <em>thing</em> (students or classrooms) did we randomly allocate our treatments?</p>
<p>If we randomly allocated reading programmes to students, then students would be the experimental units. But we didn’t, so the classroom is the experimental unit – it is the classroom to which we randomly allocated treatments.</p>
<p><em>The classroom is the experimental unit</em>.</p>
<p>However, you are right - we don’t <em>measure</em> how a classroom reads; we measure how students read. Thus <em>students are the measurement units</em> for this experiment.</p>
</div>
<div id="psudo-replication-1" class="section level3 hasAnchor" number="12.4.3">
<h3 class="hasAnchor"><span class="header-section-number">12.4.3</span> Psudo-replication<a href="#psudo-replication-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Confusing these two things can lead to <strong>pseudo-replication</strong>. Treating measurement units as experimental usually leads to overoptimistic analysis — we will reject null hypotheses more often than we should, and our confidence intervals will be too narrow. The usual way around this is to determine a single response for each experimental unit.</p>
<p>Consider an experiment with two growth chambers each containing 100 plants. One of the chambers received enhanced C02. One night after collecting data you leave the door open on the C02 chamber and the temperature drops and so the plants grow more slowly. When you come to analyze the data you get a highly significant effect of slow growth. However, that C02 results in reduced plant growth not what you expect (CO2 is good for photosynthesis…).</p>
<p>This is an entirely plausible outcome caused by misallocating plants as the experimental unit - it was really the CO2 chamber… to avoid such problems, one needs many chambers.</p>
<p>Consider a second experiment where you have 200 growth chambers and randomly allocate plants to each. If you <em>forget to close one door</em> it really has no effect as just one plant is affected. In fact, to get the same effect as in the first experiment you would have to accidentally leave the doors open on all 100 of the elevated C02 chambers. This is very unlikely indeed!!!</p>
<blockquote>
<p>There are 9 x 1058 ways selecting 100 chambers from 200 chambers so the chance of accidentally picking all the elevated C02 chambers is 1/ 9x1058￼0 (stars in universe 7 x 1022).</p>
</blockquote>
<p>Proper <strong>randomization</strong> and <strong>replication</strong> is very different from <strong>pseudo-replication</strong>.</p>
</div>
<div id="randomization-properly-with-replication-protects-against-confounding-1" class="section level3 hasAnchor" number="12.4.4">
<h3 class="hasAnchor"><span class="header-section-number">12.4.4</span> Randomization properly with Replication protects against Confounding<a href="#randomization-properly-with-replication-protects-against-confounding-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An experiment is properly randomized if the method for assigning treatments to units involves a known, well-understood probabilistic scheme. The probabilistic scheme is called a randomization.</p>
<blockquote>
<p>In general, more experimental units with fewer measurement units per experimental unit works better.</p>
</blockquote>
<p>No matter which features of the population of experimental units are associated with our response, our randomizations should put approximately <em>half the individuals with these features</em> into <em>each treatment group</em>.</p>
<p>Recall our example above of considering sex and age of subjects and imagine a treatment with two levels (hot and cold). Done well, proper randomisation will put approximately half the males, half the females, half the older, half the younger etc into each of the treatment levels.</p>
<p>The beauty of randomization is that it helps prevent <em>confounding</em>, even for factors that we do not know are important.</p>
</div>
<div id="haphazard-is-not-randomized---beware-the-non-randomized-experiment-1" class="section level3 hasAnchor" number="12.4.5">
<h3 class="hasAnchor"><span class="header-section-number">12.4.5</span> <strong>haphazard</strong> is NOT randomized - beware the non-randomized experiment –<a href="#haphazard-is-not-randomized---beware-the-non-randomized-experiment-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A company is evaluating two different word processing packages for use by its clerical staff. Part of the evaluation is how quickly a test document can be entered correctly using the two programs. We have 20 test secretaries, and each secretary will enter the document twice, using each programme once.</p>
<p>Suppose that all secretaries did the evaluation in the order A first and B second. Does the second programme have an advantage because the secretary will be familiar with the document and thus enter it faster? Or maybe the second programme will be at a disadvantage because the secretary will be tired and thus slower?</p>
<p>Randomization generally costs little in time and trouble, but it can save us from <code>disaster</code>. The experiment above needs secretaries randomly assigned to A first -&gt; B second and B first -&gt; A second (50% in each!).</p>
<p>Anything that might affect your responses should be <em>randomized</em>! For example</p>
<ul>
<li>If the experimental units are not used simultaneously, you can (should) randomize the order in which they are used.</li>
<li>If the experimental units are not used at the same location, you can (should) randomize the locations at which they are used.</li>
<li>If you use more than one measuring instrument for determining response, you can (should) randomize which units are measured on which instruments.</li>
</ul>
</div>
</div>
<div id="mini-quiz-1" class="section level2 hasAnchor" number="12.5">
<h2 class="hasAnchor"><span class="header-section-number">12.5</span> Mini-Quiz<a href="#mini-quiz-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>A PhD student want to determine the effects of protein on beetle reproduction, so they design an experiment with a control and protein enhanced diet. To assign beetles to each of the treatments they pour a culture onto the table and catch the first 30 beetles that run to the edge of the table, these receive the protein enhanced diet. The next 30 beetles go in the control. <strong>Is this randomized?</strong></p>
</blockquote>
<p>(Hmm …. is there anything about the first 30 beetles that reach the edge of the table that could <em>bias</em> your inference?)</p>
</div>
<div id="replication-how-many-1" class="section level2 hasAnchor" number="12.6">
<h2 class="hasAnchor"><span class="header-section-number">12.6</span> Replication: How many?<a href="#replication-how-many-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There is a really common question that people ask. How many replicates do I need? Unfortunatly, there are no simple rules… it depends… on….</p>
<ul>
<li>Resources available ($/£/€ and equipment and time)</li>
<li>Variability of experimental units</li>
<li>Treatment structure</li>
<li>Size of effect (response)</li>
<li>Relative importance of different comparisons</li>
</ul>
<p>There is, however, a set of tools that can help with estimating sample sizes. It’s called power analysis and requires that you have some a priori estimate of the expected variation in your response variable.</p>
<!--chapter:end:02-Experiments_and_Some_Philosophy.Rmd-->
<!--chapter:end:bookdown-demo.Rmd-->
</div>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
